<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-syntaxflow-guide docs-version-current docs-doc-page docs-doc-id-statements/intro-and-desc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.1">
<title data-rh="true">1. desc 语句：准备并编写基础描述 | SSA.to</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ssa.to/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ssa.to/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ssa.to/en/syntaxflow-guide/statements/intro-and-desc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-syntaxflow-guide-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-syntaxflow-guide-current"><meta data-rh="true" property="og:title" content="1. desc 语句：准备并编写基础描述 | SSA.to"><meta data-rh="true" name="description" content="在学习编写 SyntaxFlow 规则之前，为了方便用户理解使用，我们使用 XXE 这个漏洞来进行教学，用户可以在手动实现对这个漏洞的分析检测过程中，掌握 SyntaxFlow 的编写技术。"><meta data-rh="true" property="og:description" content="在学习编写 SyntaxFlow 规则之前，为了方便用户理解使用，我们使用 XXE 这个漏洞来进行教学，用户可以在手动实现对这个漏洞的分析检测过程中，掌握 SyntaxFlow 的编写技术。"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ssa.to/en/syntaxflow-guide/statements/intro-and-desc"><link data-rh="true" rel="alternate" href="https://ssa.to/syntaxflow-guide/statements/intro-and-desc" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ssa.to/en/syntaxflow-guide/statements/intro-and-desc" hreflang="en"><link data-rh="true" rel="alternate" href="https://ssa.to/syntaxflow-guide/statements/intro-and-desc" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.e4c0332c.css">
<script src="/en/assets/js/runtime~main.3ee32609.js" defer="defer"></script>
<script src="/en/assets/js/main.994e1272.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo-dark.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SSA.to</b></a><a class="navbar__item navbar__link" href="/en/static-analysis-guide/intro">静态代码分析教程</a><a class="navbar__item navbar__link" href="/en/docs/intro">代码扫描基础使用</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/syntaxflow-guide/intro">SyntaxFlow 文档</a><a class="navbar__item navbar__link" href="/en/cookbook">SyntaxFlow 手册离线 PDF</a><a class="navbar__item navbar__link" href="/en/codeAnalysis">Code Analysis NOW!</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yaklang/ssa.to" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/syntaxflow-guide/statements/intro-and-desc" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">中文</a></li><li><a href="/en/syntaxflow-guide/statements/intro-and-desc" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><div class="navbarSearchContainer_dCNk"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eExm"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/syntaxflow-guide/intro">SyntaxFlow 简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/syntaxflow-guide/quick-start">SyntaxFlow 快速入门指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/syntaxflow-guide/rule-intro">SyntaxFlow 规则文件介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/en/syntaxflow-guide/rule-intro">编写基础的 SyntaxFlow 规则</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/rule-intro">SytanxFlow 规则介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/syntaxflow-guide/statements/intro-and-desc">1. desc 语句：准备并编写基础描述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-search">2. 搜索定位：搜索符号或方法名</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-func-call">3. 函数调用：审计调用和参数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-variable">4. 变量：存储和追踪审计结果</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-dot-call-chain">5. 链式调用：递归检查成员和调用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-dataflow">6. 数据流运算：追踪定义和使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-filter">7. 过滤器：?{...} 筛选审计结果</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-calc">8. 集合运算：交集 &amp;，差集 -，并集 +</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-nativecall">9. 原生扩展：重要的 NativeCall 机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf-sca">10. SCA: 依赖版本信息检测</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/statements/sf_file_filter">11. 文件过滤：检测文件内容</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/syntaxflow-guide/nativecall-demos">常见 NativeCall 以及用例</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/en/syntaxflow-guide/advanced/advanced-analyzing-dataflow">高级静态代码分析实战</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/syntaxflow-guide/advanced/advanced-analyzing-dataflow">数据流敏感的代码漏洞检测</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">编写基础的 SyntaxFlow 规则</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">1. desc 语句：准备并编写基础描述</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>1. <code>desc</code> 语句：准备并编写基础描述</h1></header>
<p>在学习编写 SyntaxFlow 规则之前，为了方便用户理解使用，我们使用 XXE 这个漏洞来进行教学，用户可以在手动实现对这个漏洞的分析检测过程中，掌握 SyntaxFlow 的编写技术。</p>
<!-- -->
<div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#准备要审计的代码">准备要审计的代码</a><ul><li><a href="#代 码解释">代码解释</a></li><li><a href="#存在的-xxe-漏洞">存在的 XXE 漏洞</a></li></ul></li><li><a href="#编译源码">编译源码</a></li><li><a href="#编写描述">编写描述</a><ul><li><a href="#spec语句-desc">SPEC：语句 <code>desc</code></a></li><li><a href="#语法结构">语法结构</a></li><li><a href="#语法定义">语法定义</a></li><li><a href="#示例解释">示例解释</a></li><li><a href="#优化描述">优化描述</a></li></ul></li><li><a href="#编写审计语句">编写审计语句</a><ul><li><a href="#从变量名或方法名开始审计">从变量名或方法名开始审计</a></li></ul></li></ul></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备要审计的代码">准备要审计的代码<a href="#准备要审计的代码" class="hash-link" aria-label="Direct link to 准备要审计的代码" title="Direct link to 准备要审计的代码">​</a></h2>
<p>我们将存在 XXE 漏洞的 Java 代码保存为 <code>XXE.java</code>，并将其存放在相应的包中。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.vuln.controller;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RequestMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RequestParam;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.xml.parsers.DocumentBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.xml.parsers.DocumentBuilderFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.ByteArrayInputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.InputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController(value = &quot;/xxe&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class XXEController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = &quot;/one&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String one(@RequestParam(value = &quot;xml_str&quot;) String xmlStr) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DocumentBuilder documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        InputStream stream = new ByteArrayInputStream(xmlStr.getBytes(&quot;UTF-8&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        org.w3c.dom.Document doc = documentBuilder.parse(stream);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        doc.getDocumentElement().normalize();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;Hello World&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这段代码位于一个使用 Spring Framework 构建的 Web 应用中，定义了一个处理 XML 数据的控制器 <code>XXEController</code>。控制器中的 <code>one</code> 方法用来处理通过 HTTP 请求传递的 XML 字符串。以下是代码的具体行为和存在的安全问题：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码解释">代码解释<a href="#代码解释" class="hash-link" aria-label="Direct link to 代码解释" title="Direct link to 代码解释">​</a></h3>
<ol>
<li>
<p><strong><code>@RestController(value = &quot;/xxe&quot;)</code></strong><br>
<!-- -->注解定义了一个 RESTful 控制器，其所有请求的基础 URL 是 <code>/xxe</code>。</p>
</li>
<li>
<p><strong><code>@RequestMapping(value = &quot;/one&quot;)</code></strong><br>
<!-- -->注解表明，<code>one</code> 方法将处理对 <code>/xxe/one</code> 的 HTTP 请求。</p>
</li>
<li>
<p><strong>方法 <code>one</code> 接收请求参数</strong><br>
<!-- -->方法 <code>one</code> 接收一个名为 <code>xml_str</code> 的请求参数，这个参数通过 <code>@RequestParam</code> 注解获得。这个参数预期包含 XML 格式的数据。</p>
</li>
<li>
<p><strong>创建 <code>DocumentBuilder</code> 实例</strong><br>
<code>DocumentBuilderFactory.newInstance().newDocumentBuilder()</code> 创建了一个 <code>DocumentBuilder</code> 实例，用于解析 XML 数据。</p>
</li>
<li>
<p><strong>创建 <code>InputStream</code></strong><br>
<code>new ByteArrayInputStream(xmlStr.getBytes(&quot;UTF-8&quot;))</code> 创建了一个 <code>InputStream</code>，它从传入的字符串 <code>xml_str</code> 中读取数据。</p>
</li>
<li>
<p><strong>解析 XML 数据</strong><br>
<code>documentBuilder.parse(stream)</code> 解析这个流，尝试构建一个 DOM 树。</p>
</li>
<li>
<p><strong>规范化文档结构</strong><br>
<code>doc.getDocumentElement().normalize()</code> 规范化文档结构，确保 DOM 树的结构正确。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="存在的-xxe-漏洞">存在的 XXE 漏洞<a href="#存在的-xxe-漏洞" class="hash-link" aria-label="Direct link to 存在的 XXE 漏洞" title="Direct link to 存在的 XXE 漏洞">​</a></h3>
<p>这段代码存在 XML 外部实体 (XXE) 漏洞，原因如下：</p>
<ol>
<li>
<p><strong>默认的解析器设置</strong><br>
<code>DocumentBuilderFactory</code> 的默认配置不禁用外部实体的处理。这意味着如果 XML 输入包含对外部实体的引用，解析器将尝试解析这些实体。</p>
</li>
<li>
<p><strong>安全风险</strong><br>
<!-- -->攻击者可以利用 XML 输入中的外部实体，引导服务器解析恶意内容。例如，攻击者可能会引入指向敏感文件（如 <code>/etc/passwd</code>）的实体，导致敏感信息泄露。此外，恶意的外部实体还可以用来触发拒绝服务攻击（DoS）等。</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="编译源码">编译源码<a href="#编译源码" class="hash-link" aria-label="Direct link to 编译源码" title="Direct link to 编译源码">​</a></h2>
<p>进入 <code>XXE.java</code> 所在的目录，执行以下命令即可编译：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yak ssa -t . --program xxe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编译完成后，你将会在输出中看到以下日志，看到 <code>finished compiling</code> 则说明编译完成了。</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [ssacli:132] start to compile file: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [ssacli:148] compile save to database with program name: xxe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [ssa:42] init ssa database: /Users/v1ll4n/yakit-projects/default-yakssa.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [language_parser:46] parse project in fs: *filesys.LocalFs, localpath: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [language_parser:152] file[XXE.java] is supported by language [java], use this language</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] 2024-06-26 11:52:38 [visit_package:31] Dependencies Missed: Import package [org.springframework.web.bind.annotation.RequestMapping] but not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [language_parser:68] compile XXE.java cost: 194.70225ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [language_parser:72] program include files: 2 will not be as the entry from project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] 2024-06-26 11:52:38 [reducer:51] Compile error: parse file xxe.sf error: file[xxe.sf] is not supported by any language builder, skip this file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:52:38 [ssacli:163] finished compiling..., results: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="编写描述">编写描述<a href="#编写描述" class="hash-link" aria-label="Direct link to 编写描述" title="Direct link to 编写描述">​</a></h2>
<p>在大致了解了 SF 规则文件之后，我们可以开始构建自己的 SF 文件。首先，创建一个名为 <code>xxe.sf</code> 的文件，并在文件中写入以下内容：</p>
<div class="language-sf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">desc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title: &quot;Check XXE Vulnerability in DocumentBuilderFactory&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>显然，这段代码仅仅添加了一点文件描述信息，并不会产生实际的审计效果。然而，添加描述有助于在结果输出时包含对结果的解读信息，因此仍然是非常必要的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spec语句-desc">SPEC：语句 <code>desc</code><a href="#spec语句-desc" class="hash-link" aria-label="Direct link to spec语句-desc" title="Direct link to spec语句-desc">​</a></h3>
<div class="language-ebnf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ebnf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// descriptionStatement 将使用 stringLiteral 描述 filterExpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">descriptionStatement: Desc ((&#x27;(&#x27; lines? descriptionItems? &#x27;)&#x27;) | (&#x27;{&#x27; lines? descriptionItems? &#x27;}&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">descriptionItems: lines? (descriptionItem descriptionSep)* descriptionItem descriptionSep? ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">descriptionItem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    : comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | stringLiteral</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | stringLiteral &#x27;:&#x27; descriptionItemValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">descriptionSep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    : &#x27;,&#x27; lines?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">descriptionItemValue: stringLiteral | hereDoc | numberLiteral;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 <code>SyntaxFlow</code> 规则文件中，<code>desc</code> 语句用于为规则提供描述性的文本，这有助于理解规则的目的和应用场景。此语句可以包含一条或多条描述项，这些项可以单独列出或配对（键和值）。下面是关于如何编写 <code>desc</code> 语句的详细教程，以及如何通过案例来实际应用这些语句。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="语法结构">语法结构<a href="#语法结构" class="hash-link" aria-label="Direct link to 语法结构" title="Direct link to 语法结构">​</a></h3>
<p><code>desc</code> 语句可以采用以下两种形式之一：</p>
<ol>
<li>使用圆括号 <code>()</code> 封装描述项。</li>
<li>使用花括号 <code>{}</code> 封装描 述项。</li>
</ol>
<p>描述项可以是单个字符串字面量，也可以是一对键和值（均为字符串字面量），用冒号 <code>:</code> 分隔。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="语法定义">语法定义<a href="#语法定义" class="hash-link" aria-label="Direct link to 语法定义" title="Direct link to 语法定义">​</a></h3>
<ul>
<li><strong>DescriptionStatement</strong>:<!-- -->
<ul>
<li><code>Desc</code> 关键词后跟括号内的描述项。括号可以是圆括号 <code>()</code> 或花括号 <code>{}</code>。</li>
</ul>
</li>
<li><strong>DescriptionItems</strong>:<!-- -->
<ul>
<li>一个或多个 <code>descriptionItem</code>，通过逗号 <code>,</code> 分隔。</li>
</ul>
</li>
<li><strong>DescriptionItem</strong>:<!-- -->
<ul>
<li>可以是：<!-- -->
<ul>
<li>注释 <code>comment</code></li>
<li>单个字符串字面量 <code>stringLiteral</code></li>
<li>键值对形式的字符串字面量，格式为 <code>key: value</code>。</li>
</ul>
</li>
</ul>
</li>
<li><strong>DescriptionItemValue</strong>:<!-- -->
<ul>
<li>可以是字符串字面量、Heredoc 或数字字面量。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例解释">示例解释<a href="#示例解释" class="hash-link" aria-label="Direct link to 示例解释" title="Direct link to 示例解释">​</a></h3>
<p>考虑以下 <code>desc</code> 语句示例：</p>
<div class="language-sf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">desc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title:&quot;Audit Unsafe Database Connection Configurations&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title_zh:&quot;审计不安全的数据库连接配置&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type:Config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    risk:&quot;信息泄露&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desc:&lt;&lt;&lt;TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    该规则用于审计数据库连接配置是否存在不安全的设置，如未加密的连接字符串或弱密码。这些配置可能导致敏感信息泄露或数据库被攻击。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    solution:&lt;&lt;&lt;TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    为了提高安全性，建议使用加密的连接字符串，并确保数据库密码强度足够高。此外，定期审查和更新数据库配置，以防止潜在的安全风险。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个例子中，<code>desc</code> 语句使用圆括号包含了一个键值对描述项：</p>
<ul>
<li><strong>title</strong>: 规则的英文名,简要概述规则的目的。</li>
<li><strong>title_zh</strong>: 规则的中文名,简要概述规则的目的。</li>
<li><strong>heredoc (<code>&lt;&lt;&lt;TEXT ... TEXT</code>)</strong>:<!-- -->
<ul>
<li><code>desc</code> 和 <code>solution</code> 使用了 Heredoc 语法来提供多行文本描述。这种方式允许在描述中包含复杂的文本内容，而不需要担心换行或格式问题。</li>
<li>heredoc语法以<code>&lt;&lt;&lt;</code>跟着一个标识符（如 <code>TEXT</code>）开始，直到遇到相同的标识符结束。</li>
</ul>
</li>
<li><strong>type</strong>: 规则的类型，这里是 <code>Config</code>，表示这是一个检测配置的规则。</li>
<li><strong>risk</strong>: 规则的风险类型，这里是 <code>信息泄露</code>。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编写教程">编写教程<a href="#编写教程" class="hash-link" aria-label="Direct link to 编写教程" title="Direct link to 编写教程">​</a></h4>
<p>编写有效的 <code>desc</code> 语句时，请遵循以下最佳实践：</p>
<ol>
<li><strong>明确目的</strong>：写清楚规则的目的和应用场景，确保其他开发者能够快速理解规则的意图。<!-- -->
<ul>
<li>使用 <code>title</code> 和 <code>title_zh</code> 来提供规则的英文和中文标题。</li>
<li>使用 <code>desc</code> 和 <code>solution</code> 来详细描述规则的功能和解决方案。</li>
<li>使用 <code>risk</code> 和 <code>type</code> 来标明规则的风险类型和类别。</li>
</ul>
</li>
<li><strong>使用多行文本</strong>：对于复杂的描述，使用 Heredoc 语法可以使文本更易读。<!-- -->
<ul>
<li>例如，使用 <code>&lt;&lt;&lt;TEXT ... TEXT</code> 来包含多行描述信息。</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优化描述">优化描述<a href="#优化描述" class="hash-link" aria-label="Direct link to 优化描述" title="Direct link to 优化描述">​</a></h3>
<p>根据上面的解释，我们可以优化我们的描述信息为：</p>
<div class="language-sf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">desc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title: &quot;Check XXE Vulnerability in DocumentBuilderFactory&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title_zh: &quot;检查 DocumentBuilderFactory 中的 XXE 漏洞&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type:Vulnerability,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    risk:XXE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desc: &lt;&lt;&lt;TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    该规则旨在检查 Java 中 DocumentBuilderFactory 的使用是否存在 XXE 漏洞。XXE（XML External Entity）漏洞可能导致敏感信息泄露或远程代码执行。通过确保 DocumentBuilderFactory 实例未设置危险特性，可以防止此类攻击。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    solution: &lt;&lt;&lt;TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    为了防止 XXE 漏洞，建议在创建 DocumentBuilderFactory 实例时，确保未  调用 setFeature、setXIncludeAware 或 setExpandEntityReferences 方法。这样可以避免解析外部实体，从而降低 XXE 攻击的风险。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当我们不进行任何审计操作时，直接执行这个语句将会输出描述信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ yak sf --program xxe xxe.sf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:53:36 [ssacli:221] start to use SyntaxFlow rule: xxe.sf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:53:36 [ssa:42] init ssa database: /Users/v1ll4n/yakit-projects/default-yakssa.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] 2024-06-26 11:53:36 [ssacli:272] syntax flow query result:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rule md5 hash: a3d1e7b19e4a536eb8a87312e09d2ec8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rule preview: desc(      title:&quot;Audit Unsafe D...期审查和更新数据库配置，以防止潜在的安全风险。  TEXT  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">description:     该规则用于审计数据库连接配置是否存在不安全的设置，如未加密的连接字符串或弱密码。这些置可能导致敏感信息泄露或数据库被攻击。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在输出中，你可以看到规则的描述信息被正确解析和显示，这为后续的审计和分析提供了清晰的上下文信息。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="编写审计语句">编写审计语句<a href="#编写审计语句" class="hash-link" aria-label="Direct link to 编写审计语句" title="Direct link to 编写审计语句">​</a></h2>
<p>审计规则是 SyntaxFlow 的核心，我们观察有漏洞的代码，发现漏洞集中在下面三行：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DocumentBuilder documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InputStream stream = new ByteArrayInputStream(xmlStr.getBytes(&quot;UTF-8&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.w3c.dom.Document doc = documentBuilder.parse(stream);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这三行中，我们发现，最重要的其实是 documentBuilder.parse(stream)。我们的审计可以先从这个地方开始。</p>
<p>如何编写 SyntaxFlow 规则找到 documentBuilder 的 parse调用？当然用户可以直接在“规则文件结构中”找到 xxe.sf 的实现直接得到答案，但是编写规则的具体细节，仍然需要用户学习，接下来我们将抽丝剥茧，逐步由浅入深地为用户解读核心规则编写的步骤。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="从变量名或方法名开始审计">从变量名或方法名开始审计<a href="#从变量名或方法名开始审计" class="hash-link" aria-label="Direct link to 从变量名或方法名开始审计" title="Direct link to 从变量名或方法名开始审计">​</a></h3>
<!-- -->
<div style="background-color:#f5f0ff;padding:1rem;margin:1rem 0;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-radius:8px"><div><h3>下一章节</h3></div><div><p></p><p>在 <a href="/en/syntaxflow-guide/statements/sf-search">搜索定位：搜索符号或方法名</a> 章节中，我们将深入介绍 SyntaxFlow 的符号搜索功能。包括如何精确定位变量、方法调用，以及如何通过模式匹配分析代码结构。这些搜索技巧将帮助您更高效地进行代码审计和漏洞分析。</p><p></p></div></div>
<blockquote>
<p>受限篇幅，本文后续内容仅供预览下一章节内容，完整的内容请参考后续章节。</p>
</blockquote>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>在代码审计过程中，找到特定变量和方法的调用位置是识别潜在漏洞的关键步骤。如果我们以 <code>documentBuilder.parse(...)</code> 这个函数调用为例，用户需要定位到 <code>documentBuilder</code> 这个变量及其 <code>parse</code> 方法的调用位置。在 <code>SyntaxFlow</code> 中，可以通过词法与符号搜索功能高效地完成这一任务。</p><p>在 <code>SyntaxFlow</code> 中，<strong>词法与符号搜索</strong>允许用户通过变量名、方法名或函数名直接定位代码中的特定位置。这一功能对于代码审计和安全分析尤为重要，因为它可以帮助用户快速、准确地定位到感兴趣的代码片段，从而高效地识别潜在的安全问题。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="搜索特定的变量名">搜索特定的变量名<a href="#搜索特定的变量名" class="hash-link" aria-label="Direct link to 搜索特定的变量名" title="Direct link to 搜索特定的变量  名">​</a></h4><p>如果你想找到代码中所有使用 <code>documentBuilder</code> 这个变量的地方，可以使用以下 <code>SyntaxFlow</code> 查询：</p><div class="language-sf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">documentBuilder;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>解释：</strong></p><ul>
<li>这条规则会匹配代码中所有 <code>documentBuilder</code> 变量的实例。无论变量是在声明、赋值还是调用中出现，都会被匹配到。</li>
</ul><p><strong>示例：</strong></p><p>假设有以下代码片段：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DocumentBuilder documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.w3c.dom.Document doc = documentBuilder.parse(stream);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <code>documentBuilder;</code> 查询将匹配到上述代码中的两个实例。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="搜索方法调用">搜索方法调用<a href="#搜索方法调用" class="hash-link" aria-label="Direct link to 搜索方法调用" title="Direct link to 搜索方法调用">​</a></h4><p>要找到所有调用 <code>parse</code> 方法的位置，可以使用以下查询：</p><div class="language-sf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.parse;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>解释：</strong></p><ul>
<li>这条规则会匹配所有对 <code>parse</code> 方法的调用。点 <code>.</code> 表示方法调用，后面跟随的方法名。</li>
</ul><p><strong>示例：</strong></p><p>继续上述代码片段：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">org.w3c.dom.Document doc = documentBuilder.parse(stream);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <code>.parse;</code> 查询将匹配到这行代码中的 <code>parse(stream)</code> 方法调用。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="组合使用变量名和方法名搜索">组合使用变量名和方法名搜索<a href="#组合使用变量名和方法名搜索" class="hash-link" aria-label="Direct link to 组合使用变量名和方法名搜索" title="Direct link to 组合使用变量名和方法名搜索">​</a></h4><p>在实际审计过程中，通常需要结合变量名和方法名进行更精确的搜索。例如，要查找 <code>documentBuilder</code> 变量上的 <code>parse</code> 方法调用，可以组合使用前面的查询：</p><div class="language-sf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">documentBuilder.parse;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>解释：</strong></p><ul>
<li>这条规则将只匹配在 <code>documentBuilder</code> 变量上调用的 <code>parse</code> 方法，而不会匹配其他变量上的 <code>parse</code> 方法调用。</li>
</ul><p><strong>示例：</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">org.w3c.dom.Document doc = documentBuilder.parse(stream);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用 <code>documentBuilder.parse;</code> 查询将准确匹配到这行代码中的 <code>parse(stream)</code> 方法调用。</p><div style="background-color:#f5f0ff;padding:1rem;margin:1rem 0;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-radius:8px"><div><h3>下一章节</h3></div><div><p></p><p>在 <a href="/en/syntaxflow-guide/statements/sf-search">搜索定位：搜索符号或方法名</a> 章节中，我们将深入介绍 SyntaxFlow 的符号搜索功能。包括如何精确定位变量、方法调用，以及如何通过模式匹配分析代码结构。这些搜索技巧将帮助您更高效地进行代码审计和漏洞分析。</p><p></p></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/yaklang/ssa.to/tree/main/syntaxflow-guide/syntaxflow-guide/statements/intro-and-desc.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-07-28T08:34:39.000Z" itemprop="dateModified">Jul 28, 2025</time></b> by <b>Youngster_程</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/syntaxflow-guide/rule-intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SytanxFlow 规则介绍</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/syntaxflow-guide/statements/sf-search"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2. 搜索定位：搜索符号或方法名</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#准备要审计的代码" class="table-of-contents__link toc-highlight">准备要审计的代码</a><ul><li><a href="#代码解释" class="table-of-contents__link toc-highlight">代码解释</a></li><li><a href="#存在的-xxe-漏洞" class="table-of-contents__link toc-highlight">存在的 XXE 漏洞</a></li></ul></li><li><a href="#编译源码" class="table-of-contents__link toc-highlight">编译源码</a></li><li><a href="#编写描述" class="table-of-contents__link toc-highlight">编写描述</a><ul><li><a href="#spec语句-desc" class="table-of-contents__link toc-highlight">SPEC：语句 <code>desc</code></a></li><li><a href="#语法结构" class="table-of-contents__link toc-highlight">语法结构</a></li><li><a href="#语法定义" class="table-of-contents__link toc-highlight">语法定义</a></li><li><a href="#示例解释" class="table-of-contents__link toc-highlight">示例解释</a></li><li><a href="#优化描述" class="table-of-contents__link toc-highlight">优化描述</a></li></ul></li><li><a href="#编写审计语句" class="table-of-contents__link toc-highlight">编写审计语句</a><ul><li><a href="#从变量名或方法名开始审计" class="table-of-contents__link toc-highlight">从变量名或方法名开始审计</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer_jryj"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/community#%E5%BE%AE%E4%BF%A1%E4%BA%A4%E6%B5%81%E7%BE%A4">Wechat</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/yaklang/ssa.to" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"></div></div><div class="footer__copyright copyright_C_OK">Copyright © 2025 ssa.to, Powered by yaklang.io</div></footer></div>
</body>
</html>