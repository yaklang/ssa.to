<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-static-analysis-guide docs-version-current docs-doc-page docs-doc-id-topic-compiler-for-static-analysis" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.1">
<title data-rh="true">议题：编译技术驱动静态分析革新 | SSA.to</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ssa.to/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ssa.to/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ssa.to/static-analysis-guide/topic-compiler-for-static-analysis"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-static-analysis-guide-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-static-analysis-guide-current"><meta data-rh="true" property="og:title" content="议题：编译技术驱动静态分析革新 | SSA.to"><meta data-rh="true" name="description" content="本议题探讨编译技术驱动的静态代码分析革新。聚焦于两方面：一是 SSA（静态单赋值形式）如何通过精确的 Use-Def 链和 Phi 指令，为静态分析提供更坚实的理论基础，并应对闭包带来的跨过程分析挑战；二是探讨如何将代码表示持久化到数据库中，利用 DSL（领域特定语言）实现高效查询和分析，从而构建基于数据库的新分析范式。议题旨在强调，静态代码分析的进步离不开底层编译技术的支撑，并将理论创新与实际应用紧密结合。"><meta data-rh="true" property="og:description" content="本议题探讨编译技术驱动的静态代码分析革新。聚焦于两方面：一是 SSA（静态单赋值形式）如何通过精确的 Use-Def 链和 Phi 指令，为静态分析提供更坚实的理论基础，并应对闭包带来的跨过程分析挑战；二是探讨如何将代码表示持久化到数据库中，利用 DSL（领域特定语言）实现高效查询和分析，从而构建基于数据库的新分析范式。议题旨在强调，静态代码分析的进步离不开底层编译技术的支撑，并将理论创新与实际应用紧密结合。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ssa.to/static-analysis-guide/topic-compiler-for-static-analysis"><link data-rh="true" rel="alternate" href="https://ssa.to/static-analysis-guide/topic-compiler-for-static-analysis" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ssa.to/en/static-analysis-guide/topic-compiler-for-static-analysis" hreflang="en"><link data-rh="true" rel="alternate" href="https://ssa.to/static-analysis-guide/topic-compiler-for-static-analysis" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.1117ee6d.css">
<script src="/assets/js/runtime~main.6d49391b.js" defer="defer"></script>
<script src="/assets/js/main.023aea22.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-dark.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SSA.to</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/static-analysis-guide/intro">静态代码分析教程</a><a class="navbar__item navbar__link" href="/docs/intro">代码扫描基础使用</a><a class="navbar__item navbar__link" href="/syntaxflow-guide/intro">SyntaxFlow 文档</a><a class="navbar__item navbar__link" href="/cookbook">SyntaxFlow 手册离线 PDF</a><a class="navbar__item navbar__link" href="/codeAnalysis">Code Analysis NOW!</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yaklang/ssa.to" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/static-analysis-guide/topic-compiler-for-static-analysis" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li><li><a href="/en/static-analysis-guide/topic-compiler-for-static-analysis" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><div class="navbarSearchContainer_dCNk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eExm"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/intro">第一章：编译与静态代码分析概论</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/static-analysis-guide/topic-compiler-for-static-analysis">议题：编译技术驱动静态分析革新</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/compile-ssa-form">第 二章：详解静态单赋值形式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/ssa-for-advanced-language">第三章：高级语言的 SSA 构建（一）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/ssa-for-advanced-language-2">第三章：高级语言的 SSA 构建（二）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-into-ssa-closure">第四章：SSA 深水区 - 分析闭包函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-into-ssa-oop">第五章：SSA 中的 OOP 实现：无类系统与原型委托</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-into-ssa-dataflow-and-cross-procedure">第六章：SSA 数据流与跨过程分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-cfg">第八章：控制流中的支配关系与 SSA Phi 指令</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">议题：编译技术驱动静态分析革新</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>议题：编译技术驱动静态分析革新</h1></header>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>本议题探讨编译技术驱动的静态代码分析革新。聚焦于两方面：一是 SSA（静态单赋值形式）如何通过精确的 Use-Def 链和 Phi 指令，为静态分析提供更坚实的理论基础，并应对闭包带来的跨过程分析挑战；二是探讨如何将代码表示持久化到数据库中，利用 DSL（领域特定语言）实现高效查询和分析，从而构建基于数据库的新分析范式。议题旨在强调，静态代码分析的进步离不开底层编译技术的支撑，并将  理论创新与实际应用紧密结合。</p></div></div>
<!-- -->
<div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#高级编译技术与静态分析">高级编译技术与静态分析</a><ul><li><a href="#编译技术重要里程碑">编译技术重要里程碑</a></li><li><a href="#ssa-基本概念">SSA 基本概念</a></li><li><a href="#ssa-引发数据流关系革新">SSA 引发数据流关系革新</a></li><li><a href="#ssa-解决难点闭包问题">SSA 解决难点：闭包问题</a></li></ul></li><li><a href="#使用建模方法构建可扩展静态代码分析引擎">使用建模方法构建可扩展静态代码分析引擎</a><ul><li><a href="#技术现状">技术现状</a></li><li><a href="#多种高级语言统一构建-ssa-ir">多种高级语言统一构建 SSA IR</a></li><li><a href="#构建多前端的-ssa-编译器">构建多前端的 SSA 编译器</a></li><li><a href="#ssa-指令集设计">SSA 指令集设计</a></li><li><a href="#线性数据库建模">线性数据库建模</a></li></ul></li></ul></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="高级编译技术与静态分析">高级编译技术与静态分析<a href="#高级编译技术与静态分析" class="hash-link" aria-label="高级编译技术与静态分析的直接链接" title="高级编译技术与静态分析的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编译技术重要里程碑">编译技术重要里程碑<a href="#编译技术重要里程碑" class="hash-link" aria-label="编译技术重要里程碑的直接链接" title="编译技术重要里程碑的直接链接">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>在 ssa.to 的理论章节中，我们在概论中简单介绍了编译技术以及 SSA 的诞生历程：</p></div></div>
<p>在20世纪80年代到90年代初期，编译器优化技术经历了一次革命性的发展。这个时期出现了一系列重要的优化技术，包括数据流分析（如到达定义分析、活跃变量分析）、经典优化技术（如常量折叠、死代码消除、公共子表达式消除）、基于控制流图的优化，以及过程间分析等。但最具革命性的突破是1991年静态单赋值形式（SSA Form）的引入。SSA形式的核心思想是：程序中的每个变量只能被赋值一次。这个看似简单的约束却带来了深远的影响。</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-基本概念">SSA 基本概念<a href="#ssa-基本概念" class="hash-link" aria-label="SSA 基本概念的直接链接" title="SSA 基本概念的直接链接">​</a></h3>
<div class="katex-wrapper" style="position:relative;padding:8px;margin:0 8px;border:1px solid transparent;border-radius:4px;display:block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container block"></div></div>
<p>SSA 的基本性质：</p>
<ol>
<li>
<p>单一赋值规则：</p><div class="katex-wrapper" style="position:relative;padding:4px;margin:0;border:1px solid transparent;border-radius:4px;display:inline-block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container inline"></div></div><p></p>
</li>
<li>
<p>φ 函数定义：</p><div class="katex-wrapper" style="position:relative;padding:4px;margin:0;border:1px solid transparent;border-radius:4px;display:inline-block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container inline"></div></div><p></p>
</li>
</ol>
<p>其中：</p>
<ul>
<li><div class="katex-wrapper" style="position:relative;padding:4px;margin:0;border:1px solid transparent;border-radius:4px;display:inline-block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container inline"></div></div> 是新的变量版本</li>
<li><div class="katex-wrapper" style="position:relative;padding:4px;margin:0;border:1px solid transparent;border-radius:4px;display:inline-block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container inline"></div></div> 是来自 k 个前驱基本块的变量版本</li>
</ul>
<ol start="3">
<li>支配性质：<div class="katex-wrapper" style="position:relative;padding:4px;margin:0;border:1px solid transparent;border-radius:4px;display:inline-block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container inline"></div></div></li>
</ol>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>在 SSA 中，支配（dominance）是指控制流图（CFG）中基本块之间的关系，而不是数据依赖关系。</p></div></div>
<p>这就是 SSA 形式最核心的定义，包含了单一赋值、φ 函数和支配关系三个关键要素。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-编译器的编译过程">SSA 编译器的编译过程<a href="#ssa-编译器的编译过程" class="hash-link" aria-label="SSA 编译器的编译过程的直接链接" title="SSA 编译器的编译过程的直接链接">​</a></h4>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-引发数据流关系革新">SSA 引发数据流关系革新<a href="#ssa-引发数据流关系革新" class="hash-link" aria-label="SSA 引发数据流关系革新的直接链接" title="SSA 引发数据流关系革新的直接链接">​</a></h3>
<p>根据定义我们知道，SSA 主要描述的其实是数据流关系，我们在 SSA 中描述数据流关系一般使用 Use-Def 链来表达。</p>
<p>在不抽象出 SSA 之前，我们对数据流的描述非常模糊，考虑如下代码，不使用 SSA 我们几乎无法分析变量究竟是怎么回事儿：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if c1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	x = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if c2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		y = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		y = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	x = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e = x + y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">println(e);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>没有 SSA 的 CFG + 数据流如下：</p>
<!-- -->
<p>在 SSA 化后，我们得到代码如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x1 = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if c1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	x2 = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if c2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		y2 = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		y3 = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y4 = φ(y2, y3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	x3 = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x4 = φ(x2, x3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y5 = φ(y1, y4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e1 = x4 + y5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">println(e1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>他的数据流图如下:</p>
<!-- -->
<p>抽象出 Use-Def 链，如下：</p>
<!-- -->
<p>我们通过 SSA 构建上述的 Use-Def 关系，可以直接发现如下现象：</p>
<ul>
<li>e1 直接依赖于 x4 和 y5</li>
<li>所有变量的定义点都是唯一的</li>
<li>φ 函数清晰地表示了变量的多个可能来源</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>数据流分析优势</div><div class="admonitionContent_BuS1"><ol>
<li>
<p>变量追踪：可以精确追踪任何变量的定义来源，并且可以清晰地分析变量在不同控制流路径上的值</p>
</li>
<li>
<p>优化机会：容易识别常量传播的机会，并且几乎可以直接消除死代码，可以准确判断变量的活跃范围，</p>
</li>
<li>
<p>分析效率：直接的前向/后向分析，无需迭代计算到达定值，版本号简化别名分析</p>
</li>
</ol></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-解决难点闭包问题">SSA 解决难点：闭包问题<a href="#ssa-解决难点闭包问题" class="hash-link" aria-label="SSA 解决难点：闭包问题的直接链接" title="SSA 解决难点：闭包问题的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="什么是闭包">什么是闭包<a href="#什么是闭包" class="hash-link" aria-label="什么是闭包的直接链接" title="什么是闭包的直接链接">​</a></h4>
<p>闭包（Closure）是一个函数与其相关的引用环境的组合体。从技术角度来说，闭包是一个记录结构（record），它包含了一个函数和一个关联的环境组件。</p>
<p>这个环境组件中包含了函数体内引用的、但是既不是函数参数也不是函数局部变量的所有变量的绑定。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="闭包的核心特性">闭包的核心特性<a href="#闭包的核心  特性" class="hash-link" aria-label="闭包的核心特性的直接链接" title="闭包的核心特性的直接链接">​</a></h4>
<ol>
<li><strong>变量捕获</strong>：闭包可以捕获其定义时所在作用域的变量，我们再补充一点，这个变量必须被使用的时候才算是“捕获”，如果不被使用，就不需要考虑这个事情了。</li>
</ol>
<div class="katex-wrapper" style="position:relative;padding:8px;margin:0 8px;border:1px solid transparent;border-radius:4px;display:block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container block"></div></div>
<ol start="2">
<li>
<p><strong>生命周期延展</strong>：被捕获的变量的生命周期会被延长至闭包函数的生命周期。</p>
</li>
<li>
<p><strong>状态保持</strong>：每个闭包实例都维护着其自己的变量状态。</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-对闭包的处理">SSA 对闭包的处理<a href="#ssa-对闭包的处理" class="hash-link" aria-label="SSA 对闭包的处理的直接链接" title="SSA 对闭包的处理的直接链接">​</a></h4>
<p>我们把闭包中，可能对外部的修改，称之为副作用（SideEffect）。</p>
<p>用更接地气的话讲，一个函数修改了外部定义域的一个变量，这个就说这个函数有一个副作用。</p>
<p>但是因为这个函数不调用，这个副作用就不生效，因此这个副作用可以理解为是一个 “静态” 的属性。</p>
<p>所以我们如果把副作用也当成一个 SSA 变量的话，并且这个副作用在闭包函数调用后自动插入 SSA 中，那么我们就可以直接分析一些动态语言的闭包问题了。</p>
<p>接下来我们看一个例子：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func myFunc() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x = x + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myFunc()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>普通的静态代码分析构建系统中，我们会构建出如下 CFG：</p>
<!-- -->
<p>在这里我们无法分辨最后的 x 到底是谁，那么，我们把上面的代码使用 SSA 编译后再看：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x1 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func myFunc() [x_freevalue] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x2 = x_freevalue + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myFunc() [x1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x3 = side_effect(x2) (x1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在改造完后，我们构建的图如下：</p>
<!-- -->
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>核心价值</div><div class="admonitionContent_BuS1"><ol>
<li><strong>静态分析能力增强</strong>：闭包不再是&quot;黑盒&quot;，其对外部变量的影响可以被静态分析，副作用被显式建模为 SSA 变量，使得闭包的行为可预测</li>
<li><strong>优化机会</strong>：可以识别闭包的纯函数性质（是否有真实的副作用），能够进行闭包内联等优化，因为副作用是显式的</li>
<li><strong>正确性保证</strong>：通过 SSA 变量版本和副作用的显式表示，保证了闭包修改外部变量的正确顺序和值</li>
</ol></div></div>
<p>这种方式的最大优势在于：它把闭包中常常被视为&quot;动态&quot;和&quot;不可预测&quot;的副作用，转化为了可以静态分析的 SSA 形式，使得我们能够在编译时就准确理解和优化闭包的行为。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用建模方法构建可扩展静态代码分析引擎">使用建模方法构建可扩展静态代码分析引擎<a href="#使用建模方法构建可扩展静态代码分析引擎" class="hash-link" aria-label="使用建模方法构建可扩展静态代码分析引擎的直接链接" title="使用建模方法构建可扩展静态代码分析引擎的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="技术现状">技术现状<a href="#技术现状" class="hash-link" aria-label="技术现状的直接链接" title="技术现状的直接链接">​</a></h3>
<p>CodeQL 可以说是一个非常典型的使用建模方法构建的静态代码分析引擎。在 CodeQL 中，用户可以把自己的程序编译到 CodeQL 数据库，我们把这个过程称为建模，然后在使用 CodeQL 的查询语言对建模后的程序进行查询。</p>
<p>值得一体的细节是说，CodeQL 的建模存储的数据一般更接近于构建 AST 建立索引，而本身不会再编译过程中进行一些高级的数据流分析优化。</p>
<p>如果我们把 SSA 技术和代码建模结合起来，那么我们就可以构建一个更强大的可以进行深度分析的静态代码分析引擎。</p>
<p>这就是我们 SSA IR + SyntaxFlow 要做的事儿。</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="多种高级语言统一构建-ssa-ir">多种高级语言统一构建 SSA IR<a href="#多种高级语言统一构建-ssa-ir" class="hash-link" aria-label="多种高级语言统一构建 SSA IR的直接链接" title="多种高级语  言统一构建 SSA IR的直接链接">​</a></h3>
<p>高级编程语言和低级编程语言的 SSA IR 构建存在非常明显的差异。在高级编程语言中，由于其强大的抽象能力，需要处理更多的语言特性，如面向对象特性（继承、多态）、闭包等，这使得SSA构建过程比低级语言更为复杂。</p>
<p>但是就静态代码分析要讨论的内容来说，实际上用户接触的大部分编程语言都是高级编程语言，直接使用低级语言的场景相对较少。</p>
<p>基于高级语言构建 SSA 的过程，本质上是把各种高级语言特性编译成更低级的 IR 的过程。我们用一张图生动的描述我们接下来要讨论的内容：</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="构建多前端的-ssa-编译器">构建多前端的 SSA 编译器<a href="#构建多前端的-ssa-编译器" class="hash-link" aria-label="构建多前端的 SSA 编译器的直接链接" title="构建多前端的 SSA 编译器的直接链接">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-指令集设计">SSA 指令集设计<a href="#ssa-指令集设计" class="hash-link" aria-label="SSA 指令集设计的直接链接" title="SSA 指令集设计的直接链接">​</a></h3>
<table><thead><tr><th>操作码</th><th>类别</th><th>说明</th></tr></thead><tbody><tr><td>SSAOpcodeAssert</td><td>调试</td><td>用于在代码中插入断言，检查某个条件是否为真</td></tr><tr><td>SSAOpcodeBasicBlock</td><td>控制流</td><td>用于表示基本的代码块，通常包含一系列的指令，没有内部的控制流</td></tr><tr><td>SSAOpcodeBinOp</td><td>计算</td><td>用于执行二元操作，如加、减、乘、除等</td></tr><tr><td>SSAOpcodeCall</td><td>函数调用</td><td>用于调用函数或方法</td></tr><tr><td>SSAOpcodeConstInst</td><td>常量</td><td>用于表示常量值</td></tr><tr><td>SSAOpcodeErrorHandler</td><td>错误处理</td><td>用于处理异常或错误</td></tr><tr><td>SSAOpcodeExternLib</td><td>外部库调用</td><td>用于调用外部库的函数或方法</td></tr><tr><td>SSAOpcodeIf</td><td>控制流</td><td>用于执行条件判断</td></tr><tr><td>SSAOpcodeJump</td><td>控制流</td><td>用于执行无条件跳转</td></tr><tr><td>SSAOpcodeLoop</td><td>控制流</td><td>用于执行循环操作</td></tr><tr><td>SSAOpcodeMake</td><td>对象创建</td><td>用于创建新的对象或数据结构</td></tr><tr><td>SSAOpcodeNext</td><td>控制流</td><td>用于跳转到下一个指令</td></tr><tr><td>SSAOpcodePanic</td><td>错误处理</td><td>用于处理不可恢复的错误情况</td></tr><tr><td>SSAOpcodeParameter</td><td>函数参数</td><td>用于表示函数或方法的参数</td></tr><tr><td>SSAOpcodeFreeValue</td><td>闭包支持</td><td>用于表示闭包中捕获的外部变量（非形式参数）</td></tr><tr><td>SSAOpcodeParameterMember</td><td>对象访问</td><td>用于访问形参的某个成员</td></tr><tr><td>SSAOpcodePhi</td><td>控制流</td><td>用于合并来自不同基本块的值</td></tr><tr><td>SSAOpcodeRecover</td><td>错误处理</td><td>用于从错误或异常中恢复</td></tr><tr><td>SSAOpcodeReturn</td><td>函数返回</td><td>用于从函数或方法中返回值</td></tr><tr><td>SSAOpcodeSideEffect</td><td>副作用</td><td>用于表示可能有副作用的操作</td></tr><tr><td>SSAOpcodeSwitch</td><td>控制流</td><td>用于执行多路分支</td></tr><tr><td>SSAOpcodeTypeCast</td><td>类型转换</td><td>用于执行类型转换</td></tr><tr><td>SSAOpcodeTypeValue</td><td>类型值</td><td>用于表示类型值</td></tr><tr><td>SSAOpcodeUnOp</td><td>计算</td><td>用于执行一元操作，如取反、递增、递减等</td></tr><tr><td>SSAOpcodeUndefined</td><td>未定义</td><td>用于表示未定义的值或状态</td></tr><tr><td>SSAOpcodeFunction</td><td>函数定义</td><td>用于定义函数或方法</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设计思想与特色">设计思想与特色<a href="#设 计思想与特色" class="hash-link" aria-label="设计思想与特色的直接链接" title="设计思想与特色的直接链接">​</a></h4>
<p>这个 SSA 指令集的设计体现了几个重要的特点和优势：</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1-完整的控制流支持">1. 完整的控制流支持<a href="#1-完整的控制流支持" class="hash-link" aria-label="1. 完整的控制流支持的直接链接" title="1. 完整的控制流支持的直接链接">​</a></h5>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>控制流指令</div><div class="admonitionContent_BuS1"><p>指令集提供了完整的控制流支持，包括：</p><ul>
<li>基本块（SSAOpcodeBasicBlock）</li>
<li>条件分支（SSAOpcodeIf）</li>
<li>循环结构（SSAOpcodeLoop）</li>
<li>多路分支（SSAOpcodeSwitch）</li>
<li>Phi 节点（SSAOpcodePhi）</li>
</ul><p>这些指令使得控制流图的构建和优化变得更加直观和高效。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2-强大的错误处理机制">2. 强大的错误处理机制<a href="#2-强大的错误处理机制" class="hash-link" aria-label="2. 强大的错误处理机制的直接链接" title="2. 强大的错误处理机制的直接链接">​</a></h5>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>错误处理</div><div class="admonitionContent_BuS1"><p>设计了三层错误处理机制：</p><ul>
<li>断言检查（SSAOpcodeAssert）：用于开发期调试</li>
<li>错误处理（SSAOpcodeErrorHandler）：用于可恢复错误</li>
<li>严重错误（SSAOpcodePanic）：用于不可恢复的错误</li>
</ul><p>这种分层的错误处理机制使得程序的健壮性和可维护性大大提高。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="3-函数式编程支持">3. 函数式编程支持<a href="#3-函数式编程支持" class="hash-link" aria-label="3. 函数式编程支持的直接链接" title="3. 函数式编程支持的直接链接">​</a></h5>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>函数式特性</div><div class="admonitionContent_BuS1"><p>指令集对函数式编程提供了良好支持：</p><ul>
<li>闭包支持（SSAOpcodeFreeValue）</li>
<li>完整的函数调用约定（SSAOpcodeCall, SSAOpcodeParameter）</li>
<li>副作用追踪（SSAOpcodeSideEffect）</li>
</ul></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4-面向对象特性">4. 面向对象特性<a href="#4-面向对象特性" class="hash-link" aria-label="4. 面向对象特性的直接链接" title="4. 面向对象特性的直接链接">​</a></h5>
<!-- -->
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5-类型系统集成">5. 类型系统集成<a href="#5-类型系统集成" class="hash-link" aria-label="5. 类型系统集成的直接链接" title="5. 类型系统集成的直接链接">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>类型系统特性</div><div class="admonitionContent_BuS1"><ul>
<li>内置类型值表示（SSAOpcodeTypeValue）</li>
<li>类型转换支持（SSAOpcodeTypeCast）</li>
<li>类型安全检查机制</li>
</ul></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="优势">优势<a href="#优势" class="hash-link" aria-label="优势的直接链接" title="优势的直接链接">​</a></h4>
<ol>
<li>
<p><strong>完整性</strong>：覆盖了从基本运算到高级语言特性的所有必要操作</p>
</li>
<li>
<p><strong>模块化</strong>：指令按功能清晰分类，便于实现和维护</p>
<ul>
<li>控制流指令</li>
<li>运算指令</li>
<li>错误处理指令</li>
<li>对象操作指令</li>
</ul>
</li>
<li>
<p><strong>可扩展性</strong>：</p>
<ul>
<li>预留了外部库调用接口（SSAOpcodeExternLib）</li>
<li>支持自定义类型和操作</li>
<li>便于添加新的优化pass</li>
</ul>
</li>
<li>
<p><strong>安全性</strong>：</p>
<ul>
<li>内置错误处理机制</li>
<li>类型安全保证</li>
<li>副作用追踪</li>
</ul>
</li>
<li>
<p><strong>优化友好</strong>：</p>
<ul>
<li>SSA 形式天然支持多种编译优化</li>
<li>Phi 节点支持数据流分析</li>
<li>基本块结构便于控制流优化</li>
</ul>
</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>这个指令集的设计特别适合现代编程语言的编译优化，尤其是在需要同时支持函数式编程和面向对象编程范式的场景下。通过合理的指令分类和完善的错误处理机制，既保证了代码的正确性，又提供了充分的优化空间。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="线性数据库建模">线性数据库建模<a href="#线性数据库建模" class="hash-link" aria-label="线性数据库建模的直接链接" title="线性数据库建模的直接链接">​</a></h3>
<p>在编译器中，中间表示(IR)通常是一个复杂的图结构，特别是 SSA 形式的 IR 包含了大量的相互引用和嵌套关系。为了有效地持久化和查询这些数据，我们需要将这种复杂的图结构转换为线性的关系模型。</p>
<table><thead><tr><th>字段分类</th><th>字段名</th><th>类型</th><th>说明</th><th>索引建议</th></tr></thead><tbody><tr><td><strong>基础信息</strong></td><td>id</td><td>integer</td><td>主键，自动递增</td><td>主键索引</td></tr><tr><td></td><td>program_name</td><td>varchar(255)</td><td>程序名称</td><td>复合索引</td></tr><tr><td></td><td>version</td><td>varchar(255)</td><td>版本信息</td><td>复合索引</td></tr><tr><td></td><td>source_code_hash</td><td>varchar(255)</td><td>源代码哈希值</td><td>普通索引</td></tr><tr><td><strong>时态信息</strong></td><td>created_at</td><td>datetime</td><td>创建时间</td><td>-</td></tr><tr><td></td><td>updated_at</td><td>datetime</td><td>更新时间</td><td>-</td></tr><tr><td></td><td>deleted_at</td><td>datetime</td><td>删除时间（软删除）</td><td>-</td></tr><tr><td><strong>源码位置</strong></td><td>source_code_start_offset</td><td>bigint</td><td>源代码开始偏移量</td><td>-</td></tr><tr><td></td><td>source_code_end_offset</td><td>bigint</td><td>源代码结束偏移量</td><td>-</td></tr><tr><td><strong>操作信息</strong></td><td>opcode</td><td>bigint</td><td>SSA 操作码</td><td>-</td></tr><tr><td></td><td>opcode_name</td><td>varchar(255)</td><td>SSA 操作码名称</td><td>-</td></tr><tr><td></td><td>opcode_operator</td><td>varchar(255)</td><td>操作符</td><td>-</td></tr><tr><td><strong>命名信息</strong></td><td>name</td><td>varchar(255)</td><td>名称</td><td>-</td></tr><tr><td></td><td>verbose_name</td><td>varchar(255)</td><td>详细名称</td><td>-</td></tr><tr><td></td><td>short_verbose_name</td><td>varchar(255)</td><td>简短详细名称</td><td>-</td></tr><tr><td></td><td>string</td><td>varchar(255)</td><td>字符串值</td><td>-</td></tr><tr><td><strong>结构信息</strong></td><td>current_block</td><td>bigint</td><td>当前块</td><td>外键索引</td></tr><tr><td></td><td>current_function</td><td>bigint</td><td>当前函数</td><td>外键索引</td></tr><tr><td><strong>函数特性</strong></td><td>is_function</td><td>bool</td><td>是否是函数</td><td>-</td></tr><tr><td></td><td>formal_args</td><td>text</td><td>形式参数</td><td>-</td></tr><tr><td></td><td>free_values</td><td>text</td><td>自由变量值</td><td>-</td></tr><tr><td></td><td>member_call_args</td><td>text</td><td>成员调用参数</td><td>-</td></tr><tr><td></td><td>side_effects</td><td>text</td><td>函数包含的副作用</td><td>-</td></tr><tr><td></td><td>is_variadic</td><td>bool</td><td>是否是可变参数函数</td><td>-</td></tr><tr><td></td><td>return_codes</td><td>text</td><td>返回代码</td><td>-</td></tr><tr><td></td><td>is_external</td><td>bool</td><td>是否是外部的</td><td>-</td></tr><tr><td><strong>控制流信息</strong></td><td>code_blocks</td><td>text</td><td>代码块</td><td>-</td></tr><tr><td></td><td>enter_block</td><td>bigint</td><td>进入块</td><td>-</td></tr><tr><td></td><td>exit_block</td><td>bigint</td><td>退出块</td><td>-</td></tr><tr><td></td><td>defer_block</td><td>bigint</td><td>延迟执行代码块</td><td>-</td></tr><tr><td><strong>函数层次</strong></td><td>children_function</td><td>text</td><td>子函数</td><td>-</td></tr><tr><td></td><td>parent_function</td><td>bigint</td><td>父函数</td><td>-</td></tr><tr><td><strong>基本块信息</strong></td><td>is_block</td><td>bool</td><td>是否是块</td><td>-</td></tr><tr><td></td><td>pred_block</td><td>text</td><td>前驱块</td><td>-</td></tr><tr><td></td><td>succ_block</td><td>text</td><td>后继块</td><td>-</td></tr><tr><td></td><td>phis</td><td>text</td><td>块中直接包含的 Phi 指令</td><td>-</td></tr><tr><td><strong>数据流信息</strong></td><td>defs</td><td>text</td><td>数据流定义</td><td>-</td></tr><tr><td></td><td>users</td><td>text</td><td>数据流中的使用者</td><td>-</td></tr><tr><td></td><td>called_by</td><td>text</td><td>调用者</td><td>-</td></tr><tr><td><strong>对象系统</strong></td><td>is_object</td><td>bool</td><td>是否是对象</td><td>-</td></tr><tr><td></td><td>object_members</td><td>text</td><td>对象成员</td><td>-</td></tr><tr><td></td><td>is_object_member</td><td>bool</td><td>是否是对象成员</td><td>-</td></tr><tr><td></td><td>object_parent</td><td>bigint</td><td>对象父级</td><td>-</td></tr><tr><td></td><td>object_key</td><td>bigint</td><td>对象键</td><td>-</td></tr><tr><td><strong>其他信息</strong></td><td>masked_codes</td><td>text</td><td>掩码代码</td><td>-</td></tr><tr><td></td><td>is_masked</td><td>bool</td><td>是否被掩码</td><td>-</td></tr><tr><td></td><td>variable</td><td>text</td><td>变量</td><td>-</td></tr><tr><td></td><td>program_compile_hash</td><td>varchar(255)</td><td>程序编译哈希值</td><td>-</td></tr><tr><td></td><td>type_id</td><td>integer</td><td>类型 ID</td><td>-</td></tr><tr><td></td><td>point</td><td>text</td><td>点</td><td>-</td></tr><tr><td></td><td>pointer</td><td>text</td><td>指针</td><td>-</td></tr><tr><td></td><td>extra_information</td><td>varchar(255)</td><td>额外信息</td><td>-</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="字段说明">字段说明<a href="#字段说明" class="hash-link" aria-label="字段说明的直接链接" title="字段说明的直接链接">​</a></h4>
<ol>
<li>
<p><strong>基础信息字段</strong></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>这些字段构成了 IR 节点的基本身份标识：</p><ul>
<li><code>id</code>: 作为主键，确保每个 IR 指令的唯一性</li>
<li><code>program_name</code> 和 <code>version</code>: 用于版本控制和程序标识</li>
<li><code>source_code_hash</code>: 用于源代码追踪</li>
</ul></div></div>
</li>
<li>
<p><strong>时态信息字段</strong></p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>支持完整的时间管理：</p><ul>
<li><code>created_at</code>: 记录创建时间</li>
<li><code>updated_at</code>: 记录更新时间</li>
<li><code>deleted_at</code>: 支持软删除功能</li>
</ul></div></div>
</li>
<li>
<p><strong>操作相关字段</strong></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>描述 SSA 指令的核心操作信息：</p><ul>
<li><code>opcode</code>: 操作的数字编码</li>
<li><code>opcode_name</code>: 操作的符号名称</li>
<li><code>opcode_operator</code>: 具体操作符</li>
</ul></div></div>
</li>
<li>
<p><strong>结构化字段</strong>
这些字段维护了 IR 的结构关系：</p>
<ul>
<li>控制流信息（<code>current_block</code>, <code>enter_block</code>, <code>exit_block</code>）</li>
<li>函数层次（<code>current_function</code>, <code>parent_function</code>）</li>
<li>基本块关系（<code>pred_block</code>, <code>succ_block</code>）</li>
</ul>
</li>
<li>
<p><strong>数据流字段</strong></p>
<div class="katex-wrapper" style="position:relative;padding:8px;margin:0 8px;border:1px solid transparent;border-radius:4px;display:block;transition:all 0.3s ease;box-shadow:none"><div class="katex-container block"></div></div>
</li>
<li>
<p><strong>对象系统字段</strong>
用于表示面向对象特性：</p>
<ul>
<li>对象标识（<code>is_object</code>）</li>
<li>成员关系（<code>object_members</code>, <code>is_object_member</code>）</li>
<li>继承关系（<code>object_parent</code>）</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="存储考虑">存储考虑<a href="#存储考虑" class="hash-link" aria-label="存储考虑的直接链接" title="存储考虑的直接链接">​</a></h4>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><ol>
<li>
<p><strong>序列化策略</strong></p>
<ul>
<li><code>text</code> 类型字段（如 <code>formal_args</code>, <code>free_values</code>）建议使用 JSON 格式序列化</li>
<li>需要考虑序列化/反序列化的性能开销</li>
</ul>
</li>
<li>
<p><strong>索引优化</strong></p>
<ul>
<li>主键索引：<code>id</code></li>
<li>外键索引：<code>current_block</code>, <code>current_function</code></li>
<li>复合索引：<code>(program_name, version)</code></li>
<li>查询索引：<code>source_code_hash</code></li>
</ul>
</li>
<li>
<p><strong>存储优化</strong></p>
<ul>
<li>对于较大的 <code>text</code> 字段，考虑使用压缩存储</li>
<li>频繁访问的字段应该放在表的前面</li>
</ul>
</li>
</ol></div></div>
<p>这种表格化的展示方式清晰地展示了每个字段的用途和关系，便于理解和实现。同时，配合的文字  说明提供了更深入的设计考虑和实现建议。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/yaklang/ssa.to/tree/main/static-analysis-guide/static-analysis-guide/topic-compiler-for-static-analysis.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>intSheep</b> <!-- -->于 <b><time datetime="2025-06-13T04:02:54.000Z" itemprop="dateModified">2025年6月13日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/static-analysis-guide/intro"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">第一章：编译与静态代码分析概论</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/static-analysis-guide/compile-ssa-form"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">第二章：详解静态单赋值形式</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#高级编译技术与静态分析" class="table-of-contents__link toc-highlight">高级编译技术与静态分析</a><ul><li><a href="#编译技术重要里程碑" class="table-of-contents__link toc-highlight">编译技术重要里程碑</a></li><li><a href="#ssa-基本概念" class="table-of-contents__link toc-highlight">SSA 基本 概念</a></li><li><a href="#ssa-引发数据流关系革新" class="table-of-contents__link toc-highlight">SSA 引发数据流关系革新</a></li><li><a href="#ssa-解决难点闭包问题" class="table-of-contents__link toc-highlight">SSA 解决难点：闭包问题</a></li></ul></li><li><a href="#使用建模方法构建可扩展静态代码分析引擎" class="table-of-contents__link toc-highlight">使用建模方法构建可扩展静态代码分析引擎</a><ul><li><a href="#技术现状" class="table-of-contents__link toc-highlight">技术现状</a></li><li><a href="#多种高级语言统一构建-ssa-ir" class="table-of-contents__link toc-highlight">多种高级语言统一构建 SSA IR</a></li><li><a href="#构建多前端的-ssa-编译器" class="table-of-contents__link toc-highlight">构建多前端的 SSA 编译器</a></li><li><a href="#ssa-指令集设计" class="table-of-contents__link toc-highlight">SSA 指令集设计</a></li><li><a href="#线性数据库建模" class="table-of-contents__link toc-highlight">线性数据库建模</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer_jryj"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/community#%E5%BE%AE%E4%BF%A1%E4%BA%A4%E6%B5%81%E7%BE%A4">Wechat</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/yaklang/ssa.to" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"></div></div><div class="footer__copyright copyright_C_OK">Copyright © 2025 ssa.to, Powered by yaklang.io</div></footer></div>
</body>
</html>