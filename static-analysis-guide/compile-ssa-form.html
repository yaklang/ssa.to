<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-static-analysis-guide docs-version-current docs-doc-page docs-doc-id-compile-ssa-form" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.1">
<title data-rh="true">第二章：详解静态单赋值形式 | SSA.to</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ssa.to/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ssa.to/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ssa.to/static-analysis-guide/compile-ssa-form"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-static-analysis-guide-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-static-analysis-guide-current"><meta data-rh="true" property="og:title" content="第二章：详解静态单赋值形式 | SSA.to"><meta data-rh="true" name="description" content="我们在前面章节已经讨论了 SSA 形式在编译器技术中的重要性，以及 SSA 形式在现代编译器技术中的应用。"><meta data-rh="true" property="og:description" content="我们在前面章节已经讨论了 SSA 形式在编译器技术中的重要性，以及 SSA 形式在现代编译器技术中的应用。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ssa.to/static-analysis-guide/compile-ssa-form"><link data-rh="true" rel="alternate" href="https://ssa.to/static-analysis-guide/compile-ssa-form" hreflang="zh"><link data-rh="true" rel="alternate" href="https://ssa.to/en/static-analysis-guide/compile-ssa-form" hreflang="en"><link data-rh="true" rel="alternate" href="https://ssa.to/static-analysis-guide/compile-ssa-form" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.1117ee6d.css">
<script src="/assets/js/runtime~main.a492eaa6.js" defer="defer"></script>
<script src="/assets/js/main.a13e2700.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-dark.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SSA.to</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/static-analysis-guide/intro">静态代码分析教程</a><a class="navbar__item navbar__link" href="/docs/intro">代码扫描基础使用</a><a class="navbar__item navbar__link" href="/syntaxflow-guide/intro">SyntaxFlow 文档</a><a class="navbar__item navbar__link" href="/cookbook">SyntaxFlow 手册离线 PDF</a><a class="navbar__item navbar__link" href="/codeAnalysis">Code Analysis NOW!</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yaklang/ssa.to" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/static-analysis-guide/compile-ssa-form" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li><li><a href="/en/static-analysis-guide/compile-ssa-form" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><div class="navbarSearchContainer_dCNk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eExm"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/intro">第一章：编译与静态代码分析概论</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/topic-compiler-for-static-analysis">议题：编译技术驱动静态分析革新</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/static-analysis-guide/compile-ssa-form">第二章：详解静态单赋值形式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/ssa-for-advanced-language">第三章：高级语言的 SSA 构建（一）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/ssa-for-advanced-language-2">第三章：高级语言的 SSA 构建（二）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-into-ssa-closure">第四章：SSA 深水区 - 分析闭包函数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-into-ssa-oop">第五章：SSA 中的 OOP 实现：无类系统与原型委托</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-into-ssa-dataflow-and-cross-procedure">第六章：SSA 数据流与跨过程分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/static-analysis-guide/deep-dive-cfg">第八章：控制流中的支配关系与 SSA Phi 指令</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">第二章：详解静态单赋值形式</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>第二章：详解静态单赋值形式</h1></header>
<p>我们在前面章节已经讨论了 SSA 形式在编译器技术中的重要性，以及 SSA 形式在现代编译器技术中的应用。</p>
<p>那么，我们希望在接下来的章节中，更详细的介绍 SSA 的概念，以及在现代编程语言特性中的应用。</p>
<hr>
<!-- -->
<hr>
<!-- -->
<div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#术语介绍">术语介绍：</a></li><li><a href="#ssa-的基本概念">SSA 的基本概念</a><ul><li><a href="#核心特征一每个变量只能被赋值一次">核心特征一：每个变量只能被赋值一次</a></li><li><a href="#核心特征二phi-函数用于合并控制流">核心特征二：Phi 函数用于合并控制流</a></li><li><a href="#核心特征三变量版本号区分">核心特征三：变量版本号区分</a></li></ul></li><li><a href="#基本块分割代码是-ssa-编译的重要前提">基本块：分割代码是 SSA 编译的重要前提</a><ul><li><a href="#基本概念-1">基本概念</a></li><li><a href="#划分基本块basic-block的重要性">划分基本块（Basic Block）的重要性</a></li><li><a href="#基础基本块划分概述">基础基本块划分概述</a></li><li><a href="#基本块basic-block之间的关系">基本块（Basic Block）之间的关系</a></li><li><a href="#典型的条件分支中的基本块关系">典  型的条件分支中的基本块关系</a></li><li><a href="#典型的循环中的基本块关系">典型的循环中的基本块关系</a></li><li><a href="#案例研究复合控制流结构中的基本块划分分析">案例研究：复合控制流结构中的基本块划分分析</a></li><li><a href="#label---goto-中的基本块切割">Label - Goto 中的基本块切割</a></li></ul></li><li><a href="#ssa-基于基本块产生-phi-函数">SSA 基于基本块产生 Phi 函数</a><ul><li><a href="#非-ssa-切割基本块">非 SSA 切割基本块</a></li><li><a href="#基本块的-ssa-转换">基本块的 SSA 转换</a></li><li><a href="#基于前驱基本块生成-phi-函数">基于前驱基本块生成 Phi 函数</a></li></ul></li><li><a href="#讨论区">讨论区</a></li></ul></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="术语介绍">术语介绍：<a href="#术语介绍" class="hash-link" aria-label="术语介绍：的直接链接" title="术语介绍：的直接链接">​</a></h2>
<p>本文开始，将会出现很多编译技术中的术语，我们希望在这里做一个简单的介绍，以便于大家理解。</p>
<ul>
<li><strong>AST</strong>：抽象语法树（Abstract Syntax Tree），是源代码的树形结构表示，每个节点代表一个语法结构。</li>
<li><strong>SSA IR</strong>：静态单赋值形式中间表示（Static Single Assignment Form Intermediate Representation），是编译器中一种中间表示形式，每个变量只能被赋值一次。</li>
<li><strong>IR</strong>：中间表示（Intermediate Representation），是编译器中一种中间表示形式，通常是SSA IR。</li>
<li><strong>左值</strong>：可以出现在赋值符号左边的东西，通常是变量，指针，数组，结构体等。</li>
<li><strong>右值</strong>：可以出现在赋值符号右边的值，通常是常量，变量，指针，数组，结构体等。</li>
<li><strong>Phi 函数或 <code>φ</code> 符号</strong>：在 SSA 形式中，Phi 函数用于处理多路  分支情况下的变量赋值，根据控制流图的不同路径，选择不同的赋值，在后续文章中的 <code>φ</code> 符号均表示 Phi 函数。</li>
<li><strong>基本块</strong>：在编译器中，基本块是代码的连续执行序列，没有分支和跳转，通常是循环或条件语句的内部。</li>
<li><strong>CFG: 控制流图</strong>：在编译器中，控制流图是代码执行流程的图形化表示，每个节点代表一个基本块，边代表控制流关系。</li>
<li><strong>闭包</strong>：在编译器中，闭包是指一个函数与其相关的环境（包括自由变量）一起被捕获和存储的组合。</li>
<li><strong>OOP</strong>：面向对象编程（Object-Oriented Programming），是一种编程范式，通过类和对象来组织代码，实现代码的复用和抽象。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-的基本概念">SSA 的基本概念<a href="#ssa-的基本概念" class="hash-link" aria-label="SSA 的基本概念的直接链接" title="SSA 的基本概念的直接链接">​</a></h2>
<p>SSA（Static Single Assignment）是一种中间表示形式，其核心特征是：</p>
<ol>
<li>每个变量只能被赋值一次</li>
<li>每次使用变量时都能明确知道它的定义来源</li>
<li>使用版本号来区分同一个变量的不同定义</li>
</ol>
<p>我们接下来将会根据下图来讨论 SSA 的几个核心问题与他们在实际生产中的概念扩展</p>
<hr>
<!-- -->
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="核心特征一每个变量只能被赋值一次">核心特征一：每个变量只能被赋值一次<a href="#核心特征一每个变量只能被赋值一次" class="hash-link" aria-label="核心特征一：每个变量只能被赋值一次的直接链接" title="核心特征一：每个变量只能被赋值一次的直接链接">​</a></h3>
<p>SSA 的核心特征是“每个变量只能被赋值一次”，这个特征在现代编译器技术中非常重要，作为对  比，我们可以观察下面这个案例：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 原始代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x = x + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x = x * 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SSA 形式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x1 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x2 = x1 + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x3 = x2 * 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 SSA 形式中，每个变量只能被赋值一次，因此我们可以看到，原始代码中的 <code>x</code> 变量在 SSA 形式中被 拆分成了多个版本，每个版本都用不同的变量名来表示。</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="覆盖-与-传递-概念解析">“覆盖” 与 “传递” 概念解析<a href="#覆盖-与-传递-概念解析" class="hash-link" aria-label="“覆盖” 与 “传递” 概念解析的直接链接" title="“覆盖” 与 “传递” 概念解析的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="覆盖释义">覆盖释义<a href="#覆盖释义" class="hash-link" aria-label="覆盖释义的直接链接" title="覆盖释义的直接链接">​</a></h5>
<p>在原始代码中，我们使用 <code>=</code> 符号表示赋值，覆盖掉了名字为 <code>x</code> 的变量。在这个操作中，<code>x</code> 这个词法符号表示的变量是一个可以重复赋值的容器。虽然在运行时，<code>x</code> 变量在任何时候都只有一个值，但是在原代码的编译期（无脚手架），我们无法知道 <code>x</code> 变量在运行时会被赋值几次，每次赋值的值是什么。</p>
<p>我们每一次对 <code>x</code> 的操作，都会“覆盖”掉 <code>x</code> 变量之前存储的值。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="传递释义">传递释义<a href="#传递释义" class="hash-link" aria-label="传递释义的直接链接" title="传递释义的直接链接">​</a></h5>
<p>我们在 SSA 的形式中，可以认为 <code>x1</code> 和 <code>x2</code> 是两个不同的变量，<code>x3</code> 是另一个变量。<code>x</code> 被分割成了三个变量，每个变量也都可以准确地找到他的数据流依赖关系。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="核心特征二phi-函数用于合并控制流">核心特征二：Phi 函数用于合并控制流<a href="#核心特征二phi-函数用于合并控制流" class="hash-link" aria-label="核心特征二：Phi 函数用于合并控制流的直接链接" title="核心特征二：Phi 函数用于合并控制  流的直接链接">​</a></h3>
<p>在静态单赋值形式（SSA）中，Phi 函数（通常写作 <code>φ</code> 函数）是一个用于在基本块的合流点处合并来自不同控制流路径的变量值的特殊函数。当程序中存在条件分支或循环时，变量可能在不同的路径上被赋予不同的值。为了保持 SSA 的特性——每个变量只被赋值一次，我们需要一种机制来在这些路径汇合时合并变量的多个版本，这就是 Phi 函数的作用。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="phi-函数的基本概念">Phi 函数的基本概念<a href="#phi-函数的基本概念" class="hash-link" aria-label="Phi 函数的基本概念的直接链接" title="Phi 函数的基本概念的直接链接">​</a></h4>
<p>Phi 函数的形式为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x = φ(x1, x2, ..., xn)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中，<code>x1</code> 到 <code>xn</code> 是来自不同控制流路径的同一个变量的不同版本，Phi 函数选择其中一个适当的值赋给 <code>x</code>，具体选择取决于实际的执行路径。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>Phi 函数并不是真实存在的运行时函数，而是编译器中用于表示变量合并的一种抽象概念。在实际的代码生成过程中，Phi 函数会被消解，具体的实现方式取决于目标机器架构。例如，编译器可能通过寄存器分配和移动指令来实现变量值的合并。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>关于 Phi 函数消解的问题，一般会在 IR 编译到更低级的字节码（LIR 或机器码）的过程中进行消解。一般编译器中的各种条件跳转，循环跳转，都会在编译期间被展开，展开后的代码中将不再存在 Phi 函数。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例分析">示例分析<a href="#示例分析" class="hash-link" aria-label="示例分析的直接链接" title="示例分析的直接链接">​</a></h4>
<p>考虑下面一段包含条件分支的代码：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 原始代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这段代码中，最终 <code>y</code> 使用到了 <code>x</code> 的值，而 <code>x</code> 在 <code>if</code> 和 <code>else</code> 分支中被赋予了不同的值，由于 if 的条件语句 <code>condition</code> 的存在，<code>x</code> 变量在 <code>if</code> 和 <code>else</code> 分支中产生了不同的值，我们无法在编译的时候确定 <code>x</code> 的值究竟是谁，所以使用 <code>phi</code> 来创建一个新的 <code>x</code> 的版本，并根据条件分支的执行路径来选择正确的 <code>x</code> 的版本。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 转换后的 SSA 形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x3 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="图形化表示">图形化表示<a href="#图形化表示" class="hash-link" aria-label="图形化表示的直接链接" title="图形化表示的直接链接">​</a></h4>
<p>为了更直观地理解，我们可以使用控制流图（CFG）来表示上述代码的执行路径和变量赋值。</p>
<!-- -->
<p>在这个图中，<code>MergePoint</code> 节点表示控制流的合流点，Phi 函数在此处用于选择正确的 <code>x</code> 值。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="phi-函数的必要性">Phi 函数的必要性<a href="#phi-函数的必要性" class="hash-link" aria-label="Phi 函数的必要性的直接链接" title="Phi 函数的必要性的直接链接">​</a></h4>
<p>如果不使用 Phi 函数，我们无法在 SSA 中正确地表示从不同控制流路径合并的变量值，因为这会导致变量被多次赋值，违反 SSA 的单赋值特性。</p>
<p>例如，下面的示例在 SSA 中是非法的：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 非法的 SSA 形式（错误）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># x1 被重复赋值，违反了 SSA 规则</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 Phi 函数可以解决这个问题：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 正确的 SSA 形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x3 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="phi-函数在循环中的应用">Phi 函数在循环中的应用<a href="#phi-函数在循环中的应用" class="hash-link" aria-label="Phi 函数在循环中的应用的直接链接" title="Phi 函数在循环中的应用的直接链接">​</a></h4>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>在本小节中,我们仅简单探讨 Phi 函数在循环结构中的应用场景。</p><p>需要注意的是,在实际的编译过程中,编译器需要首先对循环进行基本块分割(Loop Basic Block Splitting),然后通过数据流分析(Data Flow Analysis)来确定 Phi 函数的精确插入位置。这是因为 Phi 函数的插入并非循环结构的必然结果,而是取决于变量的活跃性(Variable Liveness)和定值-使用链(Def-Use Chain)等因素。</p></div></div>
<p>Phi 函数也用于处理循环中的变量合并。考虑下面的例子：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 原始代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转换为 SSA 形式：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># SSA 形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i1 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    goto loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这个例子中，Phi 函数 <code>i1 = φ(i0, i2)</code> 用于合并循环进入点的 <code>i0</code> 和循环体内部更新后的 <code>i2</code>。这表示在循环的每一遍迭代中，<code>i1</code> 的值要么是初始值 <code>i0</code>，要么是上一轮迭代更新的 <code>i2</code>。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>在普通的代码修改为 SSA 形式之后，用户很容易读懂，但是在循环修改为 SSA 形式之后，用户就会发现一些和之前不一样的内容，这是因为上述代码 SSA 形式的循环中，涉及到了 loop 基本块，if 块儿和 else 块儿。这些块儿是把代码从循环结构中切分出来得到的，在后续的文章中，我们会讲解基本块儿的划分问题。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="图解循环中的-phi-函数">图解循环中的 Phi 函数<a href="#图解循环中的-phi-函数" class="hash-link" aria-label="图解循环中的 Phi 函数的直接链接" title="图解循环中的 Phi 函数的直接链接">​</a></h4>
<!-- -->
<p>在这个控制流图中，Phi 函数所在的 <code>MergePoint</code> 节点合并了初始值 <code>i0</code> 和循环后更新的 <code>i2</code>，以供下一次迭代或退出循环时使用。</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>危险</div><div class="admonitionContent_BuS1"><p>需要注意的是，Phi 函数并不是真实存在的运行时函数，而是编译器中用于表示变量合并的一种抽象概念。在实际的代码生成过程中，Phi 函数会被消解，具体的实现方式取决于目标机器架构。例如，编译器可能通过寄存器分配和移动指令来实现变量值的合并。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="核心特征三变量版本号区分">核心特征三：变量版本号区分<a href="#核心特征三变量版本号区分" class="hash-link" aria-label="核心特征三：变量版本号区分的直接链接" title="核心特征三：变量版本号区分的直接链接">​</a></h3>
<p>SSA 的第三个核心特征是变量版本号区分。为了确保每个变量在 SSA 形式中只被赋值一次，我们需要一种机制来区分同一变量在不同赋值点的不同版本。变量版本号的引入正是为了实现这一目标。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>虽然在上面的内容中，我们已经直接或者间接的接触到了变量版本号，但是为了让大家更好的理解变量版本号，我们在这里会额外给出一些案例。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="基本概念">基本概念<a href="#基本概念" class="hash-link" aria-label="基本概念的直接链接" title="基本概念的直接链接">​</a></h4>
<p>在 SSA 形式中，每当一个变量被赋值时，都会生成该变量的一个新版本。这通常通过在变量名后添加下标或其他标识符来实现。例如，对于变量 <code>x</code>，其不同的版本可以表示为 <code>x1</code>、<code>x2</code>、<code>x3</code> 等。每一个版本都代表了变量在某个特定赋值点的值。</p>
<p><strong>示例分析</strong></p>
<p>考虑以下原始代码：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 原始代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将其转换为 SSA 形式后：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># SSA 形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x2 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x5 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这个例子中：</p>
<ul>
<li><code>x1</code> 是 <code>x</code> 的第一次赋值。</li>
<li><code>x2</code> 是基于 <code>x1</code>  的第二次赋值。</li>
<li>在条件分支中，<code>x3</code> 来自 <code>x2 * 2</code> 分支，<code>x4</code> 来自 <code>x2</code> 分支，通过 Phi 函数合并为 <code>x5</code>（在前面的核心特征二中已详细介绍）。</li>
<li><code>y1</code> 最终使用了经过 Phi 函数合并后的 <code>x5</code> 的值。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="变量版本号的管理">变量版本号的管理<a href="#变量版本号的管理" class="hash-link" aria-label="变量版本号的管理的直接链接" title="变量版本号的管理的直接链接">​</a></h4>
<p>变量版本号的管理通常由编译器在 SSA 转换过程中自动处理。以下是变量版本号管理的几个关键步骤：</p>
<ol>
<li>
<p><strong>变量重命名（Renaming）：</strong></p>
<ul>
<li>当一个变量被赋值时，编译器为其生成一个新的版本号。</li>
<li>该过程确保每个变量版本在 SSA 中只被赋值一次。</li>
</ul>
</li>
<li>
<p><strong>追踪变量依赖（Dependency Tracking）：</strong></p>
<ul>
<li>通过版本号，编译器可以精确追踪每个变量版本的定义和使用位置。</li>
<li>这有助于后续的优化，如常量传播、死代码消除等。</li>
</ul>
</li>
<li>
<p><strong>消解 Phi 函数（Phi Function Resolution）：</strong></p>
<ul>
<li>在存在多个控制流路径的情况下，Phi 函数帮助合并不同路径上的变量版本。</li>
<li>编译器在后端会将 Phi 函数转换为具体的机器指令。</li>
</ul>
</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>在变量的  版本号管理中，虽然我们可以做到消解一定程度的 Phi 函数，但是在实际的工程实践中，我们会有更优秀的算法来生成 Phi 函数，通过更好的 Phi 函数生成算法（定义域打表法），我们可以减少 Phi 函数带来的开销。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="变量版本号的优势">变量版本号的优势<a href="#变量版本号的优势" class="hash-link" aria-label="变量版本号的优势的直接链接" title="变量版本号的优势的直接链接">​</a></h4>
<p>引入变量版本号带来了多方面的优势：</p>
<ul>
<li><strong>简化数据流分析：</strong> 每个变量版本都有唯一的定义点，使得数据流分析更加直接和高效。</li>
<li><strong>支持高级优化：</strong> 例如，常量传播、死代码消除、寄存器分配等优化技术都依赖于变量版本号的精确管理。</li>
<li><strong>消除赋值冲突：</strong> 通过版本号，避免了变量多次赋值带来的冲突，实现了更清晰的变量依赖关系。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="图形化表示-1">图形化表示<a href="#图形化表示-1" class="hash-link" aria-label="图形化表示的直接链接" title="图形化表示的直接链接">​</a></h4>
<p>以下图示展示了变量版本号在 SSA 形式中的应用，并如何与 Phi 函数协同工作：</p>
<!-- -->
<p>在这个控制流图中：</p>
<ul>
<li>每次对 <code>x</code> 的赋值都会生成一个新的版本号。</li>
<li>Phi 函数指令所在的基本块合并了来自不同控制流路径的 <code>x3</code> 和 <code>x4</code>，生成新的版本 <code>x5</code>，确保 <code>y1</code> 使用的是正确的 <code>x5</code> 版本。</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>实际应用中的变量版本号</p><p>在现代编译器中，变量版本号的实现可能更加复杂，以支持高效的代码生成和优化。以下是一些实际应用中的考虑因素：</p><ol>
<li>
<p><strong>寄存器分配（Register Allocation）：</strong></p>
<ul>
<li>编译器需要将 SSA 中的每个变量版本映射到物理寄存器或内存位置。</li>
<li>变量版本号在此过程中帮助避免寄存器冲突，提高寄存器利用率。</li>
</ul>
</li>
<li>
<p><strong>优化联合（Optimization Fusion）：</strong></p>
<ul>
<li>通过跟踪变量版本，编译器可以更准确地进行指令级并行优化，如指令合并和流水线优化。</li>
</ul>
</li>
<li>
<p><strong>错误诊断与调试：</strong></p>
<ul>
<li>变量版本号的引入使得编译器能够更精确地定位变量定义和使用点，辅助错误诊断和调试工具的开发。</li>
</ul>
</li>
</ol></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例更复杂的-ssa-转换">示例：更复杂的 SSA 转换<a href="#示例更复杂的-ssa-转换" class="hash-link" aria-label="示例：更复杂的 SSA 转换的直接链接" title="示例：更复杂的 SSA 转换的直接链接">​</a></h4>
<p>考虑以下更复杂的代码片段，其中变量 <code>a</code> 和 <code>b</code> 多次赋值，并存在嵌套的控制流结构：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 原始代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转换为 SSA 形式后：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># SSA 形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b1 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a2 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a2 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b6 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a4 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这个例子中：</p>
<ul>
<li>每次对 <code>a</code> 和 <code>b</code> 的赋值都生成了新的版本。</li>
<li>Phi 函数 <code>b4 = φ(b2, b3)</code> 合并了内部 <code>if</code> 分支的不同赋值路径。</li>
<li>Phi 函数 <code>a4 = φ(a2, a3)</code> 合并了外部 <code>if</code> 分支的不同赋值路径。</li>
<li>Phi 函数 <code>b6 = φ(b4, b5)</code> 合并了外部 <code>if</code> 分支中 <code>b</code> 的赋值路径。</li>
<li>最终的 <code>y1</code> 使用了合并后的 <code>a4</code> 和 <code>b6</code> 版本，确保了 SSA 的单赋值特性。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="图形化表示-2">图形化表示<a href="#图形化表示-2" class="hash-link" aria-label="图形化表示的直接链接" title="图形化表示的直接链接">​</a></h4>
<p>下面的控制流图展示了上述复杂示例中变量版本号和 Phi 函数的应用：</p>
<!-- -->
<p>在这个图中：</p>
<ul>
<li>
<p><strong>赋值操作</strong>：</p>
<ul>
<li>每个赋值操作（如 <code>a1 = 5</code>、<code>b1 = a1 + 2</code> 等）生成了新的变量版本，确保每个变量的定义点都是唯一的。</li>
</ul>
</li>
<li>
<p><strong>外部 <code>if-else</code> 分支</strong>：</p>
<ul>
<li>在 <code>condition1</code> 为 <code>True</code> 时，<code>a</code> 被赋值为 <code>a2 = b1 * 3</code>，然后进入内部的 <code>if condition2</code> 分支。</li>
<li><strong>内部 <code>if-else</code> 分支</strong>：<!-- -->
<ul>
<li>如果 <code>condition2</code> 为 <code>True</code>，<code>b</code> 被赋值为 <code>b2 = a2 + 4</code>。</li>
<li>如果 <code>condition2</code> 为 <code>False</code>，<code>b</code> 被赋值为 <code>b3 = a2 - 1</code>。</li>
<li>不论 <code>condition2</code> 的结果如何，内部 <code>if-else</code> 分支结束后，插入 Phi 函数 <code>b4 = φ(b2, b3)</code>，将 <code>b2</code> 和 <code>b3</code> 的值合并为 <code>b4</code>。</li>
</ul>
</li>
<li>如果 <code>condition1</code> 为 <code>False</code>，<code>a</code> 被赋值为 <code>a3 = b1 + 5</code>，并且 <code>b</code> 保持为 <code>b5 = b1</code>。</li>
</ul>
</li>
<li>
<p><strong>Phi 函数的插入</strong>：</p>
<ul>
<li><strong>Phi 函数 <code>a4 = φ(a2, a3)</code></strong>：<!-- -->
<ul>
<li>位于外部 <code>if-else</code> 分支的汇合点，合并了 <code>condition1</code> 为 <code>True</code> 时的 <code>a2</code> 和 <code>condition1</code> 为 <code>False</code> 时的 <code>a3</code>。</li>
</ul>
</li>
<li><strong>Phi 函数 <code>b6 = φ(b4, b5)</code></strong>：<!-- -->
<ul>
<li>位于外部 <code>if-else</code> 分支的汇合点，合并了 <code>condition1</code> 为 <code>True</code> 时的 <code>b4</code> 和 <code>condition1</code> 为 <code>False</code> 时的 <code>b5</code>。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>最终赋值</strong>：</p>
<ul>
<li><code>y1 = a4 + b6</code> 使用了合并后的 <code>a4</code> 和 <code>b6</code> 版本，确保 <code>y1</code> 的计算基于 SSA 形式中的唯一变量版本。</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>读者可以自行检查自己对上述案例的理解，来自己评价自己是否真理解了值的版本化和 Phi 函数的位置目的。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="基本块分割代码是-ssa-编译的重要前提">基本块：分割代码是 SSA 编译的重要前提<a href="#基本块分割代码是-ssa-编译的重要前提" class="hash-link" aria-label="基本块：分割代码是 SSA 编译的重要前提的直接链接" title="基本块：分割代码是 SSA 编译的重要前提的直接链接">​</a></h2>
<p>在编译器设计中，基本块（Basic Block）的划分是实现 SSA（静态单赋值）形式的关键步骤之一。基本块将程序的控制流划分为若干不含分支的连续指令序列，每个基本块内的指令按照顺序执行，且只有入口和出口。这种划分不仅简化了控制流分析，还为后续的优化步骤奠定了基础。</p>
<p>编译器在构建 SSA 形式时,通常会先将代码划分成基本块,然后在基本块的基础上进行变量重命名和 Phi 函数的插入。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本概念-1">基本概念<a href="#基本概念-1" class="hash-link" aria-label="基本概念的直接链接" title="基本概念的直接链接">​</a></h3>
<p><strong>基本块</strong>是指在程序中一系列连续的指令，这些指令满足以下条件：</p>
<ol>
<li><strong>入口唯一</strong>：基本块内的指令只能通过块的第一个指令被执行。</li>
<li><strong>无分支中途跳入</strong>：基本块内不会有跳转指令，除了块的最后一条指令可能是跳转指令。</li>
<li><strong>无分支中途跳出</strong>：基本块中的指令会顺序执行，直到块的最后一条指令。</li>
</ol>
<p>换句话说，基本块是程序中无法被分割的最小执行单元。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="划分基本块basic-block的重 要性">划分基本块（Basic Block）的重要性<a href="#划分基本块basic-block的重要性" class="hash-link" aria-label="划分基本块（Basic Block）的重要性的直接链接" title="划分基本块（Basic Block）的重要性的直接链接">​</a></h3>
<p>在 SSA 转换过程中，基本块的划分具有以下重要作用：</p>
<ol>
<li><strong>简化控制流图（CFG）</strong>：将程序划分为基本块后，可以更清晰地构建控制流图，便于分析程序的执行路径。</li>
<li><strong>便于插入 Phi 函数</strong>：如果有基本块儿的概念，我们就可以在需要的时候通过各种算法来插入 Phi 函数（打表或高开销的遍历变量版本）。</li>
<li><strong>优化分析和转换</strong>：基本块作为 SSA 转换和各种优化算法（如死代码消除、常量折叠等）的基本处理单元，提高了编译器的效率和准确性。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础基本块划分概述">基础基本块划分概述<a href="#基础基本块划分概述" class="hash-link" aria-label="基础基本块划分概述的直接链接" title="基础基本块划分概述的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="非-ssa-形式的基本块划分">非 SSA 形式的基本块划分<a href="#非-ssa-形式的基本块划分" class="hash-link" aria-label="非 SSA 形式的基本块划分的直接链接" title="非 SSA 形式的基本块划分的直接链接">​</a></h4>
<p>让我们以之前的代码示例为基础，进一步展示基本块的划分过程，在这个案例中，我们作为对比，先讲解非 SSA 形式的基本块划分：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 原始代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="基本块划分">基本块划分<a href="#基本块划分" class="hash-link" aria-label="基本块划分的直接链接" title="基本块划分的直接链接">​</a></h5>
<p>将上述代码划分为多个基本块，每个基本块满足前述的基本块定义：</p>
<ol>
<li>
<p><strong>入口块</strong>（Entry Block）：</p>
<ul>
<li><code>a = 5</code></li>
<li><code>b = a + 2</code></li>
</ul>
</li>
<li>
<p><strong>条件判断块</strong>（Condition1 Block）：</p>
<ul>
<li><code>if condition1:</code></li>
</ul>
</li>
<li>
<p><strong>True 分支块</strong>（True Branch Block）：</p>
<ul>
<li><code>a = b * 3</code></li>
</ul>
</li>
<li>
<p><strong>内部条件判断块</strong>（Condition2 Block）：</p>
<ul>
<li><code>if condition2:</code></li>
</ul>
</li>
<li>
<p><strong>内部 True 分支块</strong>（Internal True Branch Block）：</p>
<ul>
<li><code>b = a + 4</code></li>
</ul>
</li>
<li>
<p><strong>内部 False 分支块</strong>（Internal False Branch Block）：</p>
<ul>
<li><code>b = a - 1</code></li>
</ul>
</li>
<li>
<p><strong>Else 分支块</strong>（Else Branch Block）：</p>
<ul>
<li><code>a = b + 5</code></li>
</ul>
</li>
<li>
<p><strong>下一个语块</strong>（Next Statement Block）：</p>
<ul>
<li><code>y = a + b</code></li>
</ul>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="基本块的控制流图">基本块的控制流图<a href="#基本块的控制流图" class="hash-link" aria-label="基本块的控制流图的直接链接" title="基本块的控制流图的直接链接">​</a></h5>
<p>通过 Mermaid 图表展示基本块之间的控制流关系：</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="if-语句中-ssa-形式的基本块划分">IF 语句中 SSA 形式的基本块划分<a href="#if-语句中-ssa-形式的基本块划分" class="hash-link" aria-label="IF 语句中 SSA 形式的基本块划分的直接链接" title="IF 语句中 SSA 形式的基本块划分的直接链接">​</a></h4>
<p>考虑以下 SSA 形式的比较复杂的 IF 代码：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># SSA 形式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b1 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> condition2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a2 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a2 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b6 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> a4 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="基本块的控制流图-1">基本块的控制流图<a href="#基本块的控制流图-1" class="hash-link" aria-label="基本块的控制流图的直接链接" title="基本块的控制流图的直接链接">​</a></h5>
<p>上述代码的基本块之间的控制流关系：</p>
<!-- -->
<p>在上述 SSA 友好的基本块儿切割方案中，我们把 phi 插入在条件判断块的出口处紧接的代码块儿中，这样我们就可以在条件判断块的出口处插入 Phi 函数。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本块basic-block之间的关系">基本块（Basic Block）之间的关系<a href="#基本块basic-block之间的关系" class="hash-link" aria-label="基本块（Basic Block）之间的关系的直接链接" title="基本块（Basic Block）之间的关系的直接链接">​</a></h3>
<p>在了解完基本概念和基本切割案例之后，我们来总结一下基本块之间的关系：</p>
<p>基本块之间的关系主要体现在以下几个方面：</p>
<ol>
<li><strong>连续性</strong>: 基本块通常是连续的指令序列</li>
<li><strong>前驱关系（Predecessor Relationships）</strong>: 每个基本块可能有一个或多个前驱基本块</li>
<li><strong>后继关系（Successor Relationships）</strong>: 每个基本块可能有一个或多个后继基本块</li>
</ol>
<p>其中基本块的前驱和后继关系是基本块之间关系的主要体现，复杂的前驱后继关系共同构成了复杂的代码控制流</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="典型的条件分支中的基本块关系">典型的条件分支中的基本块关系<a href="#典型的条件分支中的基本块关系" class="hash-link" aria-label="典型的条件分支中的基本块关系的直接链接" title="典型的条件分支中的基本块关系的直接链接">​</a></h3>
<!-- -->
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>由于 IF 我们在前面已经讨论过很多次了，相对来说不会构造成复杂的控制力流关系，所以不再进行展开。用户可以自行根据上述的图示来理解基本块之间的关系。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="典型的循环中的基本块关系">典型的循环中的基本块关系<a href="#典型的循环中的基本块关系" class="hash-link" aria-label="典型的循环中的基本块关系的直接链接" title="典型的循环中的基本块关系的直接链接">​</a></h3>
<p>考虑一个相对完整的循环，我们一般认为一个循环语句，有如下要素：</p>
<ul>
<li>初始化</li>
<li>循环条件</li>
<li>循环体</li>
<li>循环更新</li>
<li>循环结束</li>
<li>break 语句</li>
<li>continue 语句</li>
</ul>
<p>如果我们把上面所有要素考虑成基本块儿切割的一句，那么我们就可以得到一个相对完整的循环基本块切割方案。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="简单条件循环不含-break-和-continue">简单条件循环（不含 break 和 continue）<a href="#简单条件循环不含-break-和-continue" class="hash-link" aria-label="简单条件循环（不含 break 和 continue）的直接链接" title="简单条件循环（不含 break 和 continue）的直接链接">​</a></h5>
<!-- -->
<p>这个案例非常简单，我们不需要考虑复杂前驱后继关系，只需要考虑循环条件和循环体即可。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>案例如下：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 计算 1 到 100 的和</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化基本块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 循环条件基本块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 循环体基本块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 循环更新基本块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 循环结束基本块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Sum from 1 to 100 is: %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述内容对应的控制流图如下：</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="考虑-break-和-continue-的循环基本块切割">考虑 break 和 continue 的循环基本块切割<a href="#考虑-break-和-continue-的循环基本块 切割" class="hash-link" aria-label="考虑 break 和 continue 的循环基本块切割的直接链接" title="考虑 break 和 continue 的循环基本块切割的直接链接">​</a></h5>
<p>break 和 continue 是循环中常用的语句，它们会改变循环的执行流程。</p>
<ul>
<li>continue 语句会跳过当前循环的剩余部分，直接进入下一次循环（跳转到更新表达式的位置）。</li>
<li>break 语句会终止循环，并跳出循环体。</li>
</ul>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="案例研究复合控制流结构中的基本块划分分析">案例研究：复合控制流结构中的基本块划分分析<a href="#案例研究复合控制流结构中的基本块划分分析" class="hash-link" aria-label="案例研究：复合控制流结构中的基本块划分分析的直接链接" title="案例研究：复合控制流结构中的基本块划分分析的直接链接">​</a></h3>
<p>本案例将详细探讨一个包含循环结构(Loop Structure)和条件分支语句(Conditional Branch)的程序片段，着重分析其基本块(Basic Block)的划分原理及其控制流图(Control Flow Graph, CFG)的构建过程。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-源代码分析">1. 源代码分析<a href="#1-源代码分析" class="hash-link" aria-label="1. 源代码分析的直接链接" title="1. 源代码分析的直接链接">​</a></h4>
<p>考虑以下示例代码片段：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sum </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%d&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该代码实现了一个求偶数和的算法，其中包含了典型的循环控制结构和条件分支语句，这为我们研究基本块划分提供了一个理想的范例。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-基本块划分及控制流分析">2. 基本块划分及控制流分析<a href="#2-基本块划分及控制流分析" class="hash-link" aria-label="2. 基本块划分及控制流分析的直接链接" title="2. 基本块划分及控制流分析的直接链接">​</a></h4>
<p>基本块的划分遵循以下关键准则：</p>
<ul>
<li>一个基本块只能从其第一条指令进入</li>
<li>只能从最后一条指令退出</li>
<li>块内指令顺序执行，无分支和汇合</li>
</ul>
<p>根据上述准则，该程序可划分为7个基本块，其层次结构如下：</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-控制流图与前驱-后继关系分析">3. 控制流图与前驱-后继关系分析<a href="#3-控制流图与前驱-后继关系分析" class="hash-link" aria-label="3. 控制流图与前驱-后继关系分析的直接链接" title="3. 控制流图与前驱-后继关系分析的直接链接">​</a></h4>
<p>为了更深入地理解程序的执行流程，我们构建了详细的控制流图，并分析了各基本块间的前驱-后继关系：</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="关键特性分析">关键特性分析<a href="#关键特性分析" class="hash-link" aria-label="关键特性分析的直接链接" title="关键特性分析的直接链接">​</a></h4>
<p>根据控制流图和前驱-后继关系分析,我们可以总结出以下关键特性:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="循环结构特征">循环结构特征<a href="#循环结构特征" class="hash-link" aria-label="循环结构特征的直接链接" title="循环结构特征的直接链接">​</a></h4>
<ul>
<li>循环头(Loop Header, B2)作为循环的入口点</li>
<li>回边(Back Edge)从B5指向B2,构成循环结构</li>
<li>循环出口边(Exit Edge)从B2指向B6</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="分支结构特征">分支结构特征<a href="#分支结构特征" class="hash-link" aria-label="分支结构特征的直接链接" title="分支结构特征的直接链接">​</a></h5>
<ul>
<li>条件分支节点(B3)实现了偶数判断逻辑</li>
<li>分支合并点(B5)确保了控制流的正确汇合</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="数据流特性">数据流特性<a href="#数据流特性" class="hash-link" aria-label="数据流特性的直接链接" title="数据流特性的直接链接">​</a></h5>
<ul>
<li>循环归纳变量i的更新在B5中进行</li>
<li>累加操作(sum += i)在B4中执行</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>这种结构化的分析方法不仅有助于理解程序的控制流程，也为后续的代码优化和转换提供了基础。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="label---goto-中的基本块切割">Label - Goto 中的基本块切割<a href="#label---goto-中的基本块切割" class="hash-link" aria-label="Label - Goto 中的基本块切割的直接链接" title="Label - Goto 中的基本块切割的直接链接">​</a></h3>
<p>除了条件分支和循环流程控制之外，Goto 语句也是常见的控制流结构，一般情况下，Goto 语句会和 Label 语句一起使用，形成一个跳转表，从而实现复杂的控制流。</p>
<p>在大多数的语言中，Goto 都不允许跨函数跳转，我们这里讨论的也是不跨函数的情况。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>事实上，我们也几乎想不到 Goto 跨函数跳转的实际应用场景。</p></div></div>
<p>一般情况下，Goto 的应用场景常见于“错误处理（例如 Kernel C 中存在大量 Goto 到 Error 的标签）”，“状态机”（例如 Lua 语言中使用 Goto 语句实现状态机）这类比较高阶的编程中。虽然不常用，但是并不代表我们在进行代码块儿切割的时候不考虑这种情况。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="如何切割-goto-基本块">如何切割 GOTO 基本块<a href="#如何切割-goto-基本块" class="hash-link" aria-label="如何切割 GOTO 基本块的直接链接" title="如何切割 GOTO 基本块的直接链接">​</a></h4>
<p>考虑如下伪代码：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 代码块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 标记位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 代码块2-2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 条件判断和代码块3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IF z </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> z </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GOTO LABEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 代码块4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;完成&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们要注意，上述代码中包含 LABEL 和 GOTO，一般 GOTO 语句会和 LABEL 语句一起使用，形成一个跳转表，从而实现复杂的控制流。我们要在 LABEL 语句之前和之后进行代码块切割。同时也需要在 GOTO 语句处进行代码块切割（因为基本块中不允许存在跳转）。</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ssa-基于基本块产生-phi-函数">SSA 基于基本块产生 Phi 函数<a href="#ssa-基于基本块产生-phi-函数" class="hash-link" aria-label="SSA 基于基本块产生 Phi 函数的直接链接" title="SSA 基于基本块产生 Phi 函数的直接链接">​</a></h2>
<p>根据我们在前面讨论的 SSA 三大核心特征，我们发现最难处理的其实是 phi 的生成。</p>
<p>在一些教科书中，Phi 的生成强制绑定伴随条件分支语句和循环语句的编译实现。但是在现代的编译理论中，我们完全可以将 Phi 的生成和条件分支语句和循环语句的编译实现分离，从而简化编译器实现的复杂度。</p>
<p>我们以下面这个高难度案例来介绍这种分离的方法：</p>
<p>考虑以下 Goto 构建的复杂代码：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int x = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (cond) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    goto L1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    goto L2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    goto L3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y = x + 1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>上述代码并不是 SSA 形式的，并且读者会发现，想要凭借人脑直接把上述内容“编译”成SSA格式，其实是非常有挑战的。但是我们在本大节讲述的基本 SSA 编译方法可以比较好的解决这个问题。</p></div></div>
<p>上述代码非常复杂，包含了三个 Goto 语句，分别为 L1, L2, L3。其中，L3 中还包含了需要切割的 IF 语句。我们可以按照前文中的 GOTO 基本块切割方法，将上述代码切割成多个基本块。同时在使用 IF 的切割方法，将 L3 切割成两个基本块。</p>
<p>切割完成后，我们将得到下面的内容：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="非-ssa-切割基本块">非 SSA 切割基本块<a href="#非-ssa-切割基本块" class="hash-link" aria-label="非 SSA 切割基本块的直接链接" title="非 SSA 切割基本块的直接链接">​</a></h3>
<p>我们把代码成功切分后，发现 <code>x</code> 的值有一些奇怪，我们暂时无法确定 <code>x</code> 的值，因此使用了 <code>[something]</code> 来表示。</p>
<!-- -->
<p>上述的内容虽然我们切对了，但是并不是 SSA 形式，这也直接导致我们无法知道 <code>x</code> 的值究竟是谁。但是实际上，我们可以推断出 <code>x</code> 的值的两种可能性，一种是 <code>1</code> 一种是 <code>2</code>，那么 <code>y</code> 的值也就有 <code>2</code> 和 <code>3</code> 两种可能性。</p>
<p>根据我们本章内容的描述，其实大家更容易接受 phi 函数可以同时表示他是 <code>1</code> 或者 <code>2</code> 两种可能性，因此我们进行 SSA 改造 的时候，就得到了如下结果</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本块的-ssa-转换">基本块的 SSA 转换<a href="#基本块的-ssa-转换" class="hash-link" aria-label="基本块的 SSA 转换的直接链接" title="基本块的 SSA 转换的直接链接">​</a></h3>
<!-- -->
<p>我们发现，切割后反而画出了 SSA 形式的代码反而更容易得到最一开始的代码的切分后的 SSA 代码形式：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> x1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cond</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> L1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> L2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">goto</span><span class="token plain"> L3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> φ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x3 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于前驱基本块生成-phi-函数">基于前驱基本块生成 Phi 函数<a href="#基于前驱基本块生成-phi-函数" class="hash-link" aria-label="基于前驱基本块生成 Phi 函数的直接链接" title="基于前驱基本块生成 Phi 函数的直接链接">​</a></h3>
<p>我们仔细观察上述的图，就会发现，phi 产生的位置实际上在 BB2 中，而 BB2 的前驱基本块是 BB1 和 BB6，因此我们就可以推断出 <code>x3 = φ(x1, x2)</code>。</p>
<p>因此，我们可以得到（推断）一个前驱块生成 phi 函数的规则：</p>
<p>对于基本块 [B]，如果它有多个前驱基本块 [P₁, P₂, ..., Pₙ]，并且变量 [v] 在这些前驱基本块中被定义（赋值）过，那么在基本块 [B] 的起始处，我们需要插入一个 phi 函数来合并来自不同前驱的 [v] 的版本。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="phi-函数的形式">Phi 函数的形式<a href="#phi-函数的形式" class="hash-link" aria-label="Phi 函数的形式的直接链接" title="Phi 函数的形式的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vₐ = φ(v₁, v₂, ..., vₙ)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中：</p>
<ul>
<li><code>vᵢ</code> 表示变量 v 在前驱基本块 Pᵢ 中的版本</li>
<li><code>vₐ</code> 表示在基本块 B 中新的 SSA 版本的变量 v</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="详细解释">详细解释<a href="#详细解释" class="hash-link" aria-label="详细解释的直接链接" title="详细解释的直接链接">​</a></h5>
<ol>
<li>
<p><strong>多前驱情况</strong></p>
<ul>
<li>当一个基本块有多个前驱时，变量 [v] 可能在不同的前驱中具有不同的值（版本）</li>
<li>需要在当前基本块开始处引入新的版本来维持 SSA 特性</li>
</ul>
</li>
<li>
<p><strong>Phi 函数的作用</strong></p>
<ul>
<li>为变量引入新的版本</li>
<li>在运行时选择正确的前驱值</li>
<li>维护 SSA 形式的单一赋值特性</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="实际示例">实际示例<a href="#实际示例" class="hash-link" aria-label="实际示例的直接链接" title="实际示例的直接链接">​</a></h4>
<p>考虑以下情况，基本块 BB2（对应代码中的 L3）有两个前驱基本块：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BB1: x₁ = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BB6: x₂ = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BB2: x₃ = φ(x₁, x₂)  // 在 BB2 开始处插入</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示意图">示意图<a href="#示意图" class="hash-link" aria-label="示意图的直接链接" title="示意图的直接链接">​</a></h4>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="讨论区">讨论区<a href="#讨论区" class="hash-link" aria-label="讨论区的直接链接" title="讨论区的直接链接">​</a></h2>
<!-- -->
<div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/yaklang/ssa.to/tree/main/static-analysis-guide/static-analysis-guide/compile-ssa-form.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>wlz</b> <!-- -->于 <b><time datetime="2025-04-11T07:55:45.000Z" itemprop="dateModified">2025年4月11日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/static-analysis-guide/topic-compiler-for-static-analysis"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">议题：编译技术驱动静态分析革新</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/static-analysis-guide/ssa-for-advanced-language"><div class="pagination-nav__sublabel">下一 页</div><div class="pagination-nav__label">第三章：高级语言的 SSA 构建（一）</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#术语介绍" class="table-of-contents__link toc-highlight">术语介绍：</a></li><li><a href="#ssa-的基本概念" class="table-of-contents__link toc-highlight">SSA 的基本概念</a><ul><li><a href="#核心特征一每个变量只能被赋值一次" class="table-of-contents__link toc-highlight">核心特征一：每个变量只能被赋值一次</a></li><li><a href="#核心特征二phi-函数用于合并控制流" class="table-of-contents__link toc-highlight">核心特征二：Phi 函数用于合并控制流</a></li><li><a href="#核心特征三变量版本号区分" class="table-of-contents__link toc-highlight">核心特征三：变量版本号区分</a></li></ul></li><li><a href="#基本块分割代码是-ssa-编译的重要前提" class="table-of-contents__link toc-highlight">基本块：分割代码是 SSA 编译的重要前提</a><ul><li><a href="#基本概念-1" class="table-of-contents__link toc-highlight">基本概念</a></li><li><a href="#划分基本块basic-block的重要性" class="table-of-contents__link toc-highlight">划分基本块（Basic Block）的重要性</a></li><li><a href="#基础基本块划分概述" class="table-of-contents__link toc-highlight">基础基本块划分概述</a></li><li><a href="#基本块basic-block之间的关系" class="table-of-contents__link toc-highlight">基本块（Basic Block）之间的关系</a></li><li><a href="#典型的条件分支中的基本块关系" class="table-of-contents__link toc-highlight">典型的条件分支中的基本块关系</a></li><li><a href="#典型的循环中的基本块关系" class="table-of-contents__link toc-highlight">典型的循环中的基本块关系</a></li><li><a href="#案例研究复合控制流结构中的基本块划分分析" class="table-of-contents__link toc-highlight">案例研究：复合控制流结构中的基本块划分分析</a></li><li><a href="#label---goto-中的基本块切割" class="table-of-contents__link toc-highlight">Label - Goto 中的基本块切割</a></li></ul></li><li><a href="#ssa-基于基本块产生-phi-函数" class="table-of-contents__link toc-highlight">SSA 基于基本块产生 Phi 函数</a><ul><li><a href="#非-ssa-切割基本块" class="table-of-contents__link toc-highlight">非 SSA 切割基本块</a></li><li><a href="#基本块的-ssa-转换" class="table-of-contents__link toc-highlight">基本块的 SSA 转换</a></li><li><a href="#基于前驱基本块生成-phi-函数" class="table-of-contents__link toc-highlight">基于前驱基本块生成 Phi 函数</a></li></ul></li><li><a href="#讨论区" class="table-of-contents__link toc-highlight">讨论区</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer_jryj"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/community#%E5%BE%AE%E4%BF%A1%E4%BA%A4%E6%B5%81%E7%BE%A4">Wechat</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/yaklang/ssa.to" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"></div></div><div class="footer__copyright copyright_C_OK">Copyright © 2025 ssa.to, Powered by yaklang.io</div></footer></div>
</body>
</html>